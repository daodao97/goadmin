import{l as C}from"./lodash-e851e67e.js";import{b as q,A as T,F as ee,N as P,S as Xe,m as N,H as ve,E as J,z as Rt,q as Ht,X as Ze,c as fe,d as Ut,O as zt,U as be,Q as qt,D as et,k as He,f as Kt,g as Yt,u as Wt,i as pe,j as Gt,l as Ue,P as ze,w as Jt,T as qe,V as Ke,Z as Ye,n as Qt,o as Xt,W as Zt}from"./okiss-utils-602c6998.js";import{D as el,F as tl,m as z,p as Y,G as tt,H as lt,q as W,I as ll,B as at,J as oe,d as ot,K as we,L as al,M as Q,N as se,g as Ve,j as ke,O as Ce,v as ol,P as sl,Q as nl,R as st,S as il,T as rl,U as ul,E as Se,V as dl,A as pl,o as xe,W as nt,X as cl,r as ml,s as hl,t as fl,a as it,Y as rt,Z as ut,_ as bl,n as _e,$ as yl,a0 as gl,a1 as vl,a2 as wl}from"./element-plus-06cec8db.js";import"./vue-d82d38a0.js";import{Q as dt,l as Vl,o as kl,B as $e,A as pt,R as Cl,S as ct,k as Sl}from"./element-plus-icons-vue-13dcdfc2.js";import{W as xl}from"./inputmask-c35b6c2e.js";import{G as _l}from"./vuedraggable-f53fb1c9.js";import{g as $l}from"./dayjs-f18a4a92.js";import{F as Ol}from"./file-saver-23ab84fd.js";import{u as ge,w as Al,S as Bl}from"./xlsx-624236af.js";import{S as Dl}from"./sortablejs-73a6c5da.js";import{h as A,o as Oe,c as U,j as u,n as c,q as p,k as g,I as F,x as $,F as j,y,v as V,O as jl,L as B,f as Ae,d as El,l as x,g as ne,P as mt,s as G,e as Tl,z as ht,U as Z,J as me,m as L,a as Be,t as K,r as X,N as ft,R as De,S as je}from"./vue-runtime-core-ffab33f8.js";import{r as _,u as I,i as ie,b as Pl,m as We,e as Il,s as Fl}from"./vue-reactivity-557f7d4b.js";import{t as O,j as ce,f as Ee,n as H}from"./vue-shared-138e5322.js";import{e as Ge,v as bt,b as Ll}from"./vue-runtime-dom-97cbdded.js";var Ml=Object.defineProperty,Nl=(e,t,l)=>t in e?Ml(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,Je=(e,t,l)=>(Nl(e,typeof t!="symbol"?t+"":t,l),l);const Rl=A({name:"VSelect",inject:["formData"],props:{options:{type:[Array,Function,Object],default:()=>[]},modelValue:{type:[Array,String,Number],default:void 0},disabled:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择"},selectApi:{type:[String,Function],default:""},multiple:{type:Boolean,default:!1},multipleLimit:{type:Number,default:0},allowCreate:{type:Boolean,default:!1},filterable:{type:Boolean,default:!1},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"},tpl:{type:String,default:""},fullWidth:{type:Boolean,default:!1},effectData:{type:[Object,String],default:()=>{}},immediate:{type:Boolean,default:!1},watch:{type:String,default:""}},emits:["update:modelValue"],data(){return this.$props.watch&&this.$watch(`formData.${this.$props.watch}`,this.onWatch,{deep:!0,immediate:!0}),{loading:!1,localValue:this.$props.modelValue,localOptions:[]}},computed:{filteredOptions(){var e;return(e=this.localOptions)==null?void 0:e.filter(t=>t.when===void 0?!0:ee(this.formData,t.when))},remote(){return!!this.$props.selectApi},localFilterable(){return this.$props.selectApi?!0:this.$props.filterable},getEffectData(){if(Object.keys(this.effectData||{}).length===0)return{};const e=C.find(this.localOptions,l=>l[this.valueKey]===this.localValue);if(!e)return{};if(this.effectData==="*")return e;const t={};return Object.keys(this.effectData).forEach(l=>{e[l]!==void 0&&(t[l]=e[l])}),t}},beforeMount(){if(this.$props.modelValue&&this.$props.selectApi&&this.search(this.$props.modelValue),this.$props.immediate&&this.$props.selectApi&&this.search(this.$props.modelValue),T(this.$props.options))this.localOptions=this.$props.options;else if(N(this.$props.options)){const e=this.$props.options,t=e();t.then!==void 0?t.then(l=>{this.localOptions=l}):this.localOptions=t}else this.$props.options.then!==void 0&&this.$props.options.then(e=>{this.localOptions=e})},methods:{onWatch(){this.$props.immediate&&this.$props.selectApi&&this.search(this.$props.modelValue)},onchange(){this.$emit("update:modelValue",this.localValue,this.getEffectData)},search(e){const t=N(this.$props.selectApi)?this.$props.selectApi(e,this.formData):this.$props.selectApi,l=P(t,this.formData);this.loading=!0,T(e)&&(e=e.join(",")),C.debounce(()=>{this.$http.request({method:"GET",url:l,params:{kw:e}}).then(({data:a})=>{if(!a)return;this.loading=!1;const o=a.list||a;T(o)&&(this.localOptions=o,a.length>2e3&&this.$message.warning("搜索结果的条目过多, 可能会造成页面卡顿, 请优化"))})},200)()},getLabel(e){return this.tpl===""?e[this.labelKey]:P(this.tpl,e)},viewLabel(e){var t;let l=e;return(t=this.localOptions)==null||t.forEach(a=>{a[this.valueKey]===e&&(l=this.getLabel(a))}),l},isArray(e){return T(e)}}}),D=(e,t)=>{const l=e.__vccOpts||e;for(const[a,o]of t)l[a]=o;return l},Hl={key:0},Ul={style:{display:"inline-block",width:"100%"}},zl={key:1};function ql(e,t,l,a,o,s){const n=we,r=se,i=Ve,d=ke;return e.disabled?(u(),g("span",Hl,[e.isArray(e.localValue)?(u(!0),g(j,{key:0},F(e.localValue,(m,f)=>(u(),c(n,{key:f,class:"select-view"},{default:p(()=>[$(O(e.viewLabel(m)),1)]),_:2},1024))),128)):(u(),c(n,{key:1,class:"select-view"},{default:p(()=>[$(O(e.viewLabel(e.localValue)),1)]),_:1}))])):(u(),c(d,{key:1,ref:"select",modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=m=>e.localValue=m),placeholder:e.placeholder,loading:e.loading,multiple:e.multiple,filterable:e.localFilterable,"multiple-limit":e.multipleLimit,"allow-create":e.allowCreate,remote:e.remote,"remote-method":m=>m&&e.search(m),style:Ee(e.fullWidth?"width:100%":""),onChange:e.onchange},{default:p(()=>[(u(!0),g(j,null,F(e.filteredOptions,m=>(u(),c(i,{key:m[e.valueKey],label:e.getLabel(m),value:m[e.valueKey]},{default:p(()=>[m.previewHtml?(u(),c(r,{key:0,"raw-content":"",effect:"light",content:m.previewHtml,placement:"right"},{default:p(()=>[x("span",Ul,O(e.getLabel(m)),1)]),_:2},1032,["content"])):(u(),g("span",zl,O(e.getLabel(m)),1))]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading","multiple","filterable","multiple-limit","allow-create","remote","remote-method","style","onChange"]))}const yt=D(Rl,[["render",ql]]),Kl=A({__name:"VRadio",props:{modelValue:{type:[Number,String,Boolean],required:!0,default:0},options:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const l=_(e.modelValue),a=()=>{t("update:modelValue",l.value)};return(o,s)=>{const n=el,r=tl;return u(),c(r,{modelValue:I(l),"onUpdate:modelValue":s[0]||(s[0]=i=>ie(l)?l.value=i:null),disabled:e.disabled,onChange:a},{default:p(()=>[(u(!0),g(j,null,F(e.options,(i,d)=>(u(),c(n,{key:d+"-radio",label:i.value,disabled:!!i.disabled},{default:p(()=>[$(O(i.label),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue","disabled"])}}});function Te(){return ne().appContext.config.globalProperties}const Yl=A({__name:"VChecbox",props:{options:{type:Array,default:()=>[]},modelValue:{type:[Array,void 0],default:()=>[]},disabled:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0},optionsApi:{type:String,default:""},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"},ctrl:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e,a=_(l.modelValue??[]),o=_(l.options??[]),s=()=>{t("update:modelValue",a.value)},n=Te().$http;l.optionsApi!==""&&(n==null||n.get(l.optionsApi).then(({data:m})=>{o.value=m||[]}));const r=()=>{const m=[];o.value.forEach(f=>{m.push(f[l.valueKey])}),a.value=m,s()},i=()=>{a.value=[],s()},d=()=>{const m=[];o.value.forEach(f=>{m.push(f[l.valueKey])}),a.value=m.filter(f=>!new Set(a.value).has(f)),s()};return(m,f)=>{const v=z,b=Y,h=tt,w=lt,S=W;return u(),c(S,null,{default:p(()=>[e.ctrl?(u(),c(b,{key:0},{default:p(()=>[y(v,{text:"",type:"primary",onClick:r},{default:p(()=>[$("全选")]),_:1}),y(v,{text:"",type:"primary",onClick:i},{default:p(()=>[$("全不选")]),_:1}),y(v,{text:"",type:"primary",onClick:d},{default:p(()=>[$("反选")]),_:1})]),_:1})):V("",!0),y(b,null,{default:p(()=>[y(w,{modelValue:I(a),"onUpdate:modelValue":f[0]||(f[0]=k=>ie(a)?a.value=k:null),max:e.max,min:e.min,disabled:e.disabled,onChange:s},{default:p(()=>[(u(!0),g(j,null,F(I(o),(k,E)=>(u(),c(h,{key:E+"-checkbox",label:k[l.valueKey]},{default:p(()=>[$(O(k[l.labelKey]),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","max","min","disabled"])]),_:1})]),_:1})}}}),Wl={name:"VRangeNumber",props:{modelValue:{type:[Array,String],default:","},disabled:{type:Boolean,default:!1},unit:{type:String,default:""},width:{type:String,default:"350px"}},emits:["update:modelValue"],data(){let e,t;return T(this.$props.modelValue)?[e,t]=this.$props.modelValue.map(l=>Number(l)):[e,t]=this.$props.modelValue.split(","),{localValue:this.arrToNum([e,t]),isFocus:!1}},methods:{active(e){this.isFocus=!!e},varToNum(e){return(e+"").replace(/[^\d.]/g,"").replace(/\.+/,".")},arrToNum(e){return e.map(t=>{if(t==="")return;const l=this.varToNum(t);return Number(l)})},onchange(){this.localValue=this.arrToNum(this.localValue),this.$emit("update:modelValue",this.localValue)}}},Gl=e=>(De("data-v-da091ba3"),e=e(),je(),e),Jl=["disabled"],Ql=Gl(()=>x("span",{class:"el-range-separator"},"~",-1)),Xl=["disabled"],Zl={key:0,class:"el-range-separator"};function ea(e,t,l,a,o,s){const n=mt("out-click");return G((u(),g("div",{class:H("el-date-editor el-date-editor--datetimerange el-input__wrapper el-range-editor "+(o.isFocus?" is-active":"")),style:Ee({width:l.width})},[G(x("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>o.localValue[0]=r),autocomplete:"off",class:"el-range-input",disabled:l.disabled,onChange:t[1]||(t[1]=(...r)=>s.onchange&&s.onchange(...r)),onFocus:t[2]||(t[2]=r=>s.active(!0))},null,40,Jl),[[Ge,o.localValue[0],void 0,{number:!0}]]),$(),Ql,$(),G(x("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>o.localValue[1]=r),autocomplete:"off",class:"el-range-input",disabled:l.disabled,onChange:t[4]||(t[4]=(...r)=>s.onchange&&s.onchange(...r)),onFocus:t[5]||(t[5]=r=>s.active(!0))},null,40,Xl),[[Ge,o.localValue[1],void 0,{number:!0}]]),$(),l.unit?(u(),g("span",Zl,O(l.unit),1)):V("",!0)],6)),[[n,()=>s.active(!1)]])}const ta=D(Wl,[["render",ea],["__scopeId","data-v-da091ba3"]]),la={__name:"MonacoEditor",props:{mod:{type:String,default:"html"},modelValue:{type:String,default:""},options:{type:Object,default:()=>({})},clearable:{type:Boolean,default:!1},vsPath:{type:String,default:"https://cdn.jsdelivr.net/npm/monaco-editor@0.30.1/min/vs"}},emits:["update:modelValue","blur"],setup(e,{expose:t,emit:l}){const a=e,o=Tl("vsPath",""),s=b=>{if(document.getElementById(b))return;const h=document.createElement("script");h.type="text/javascript",h.src=b,h.id=b,document.body.append(h)},n=()=>{if(window.monaco)return new Promise(h=>h(window.monaco));const b=o||a.vsPath;return s(b+"/loader.js"),new Promise((h,w)=>{const S=setInterval(()=>{window.require&&(require.config({paths:{vs:b}}),require(["vs/editor/editor.main"],()=>{h(window.monaco),clearInterval(S)},()=>{w("error")}))},50)})},r=_();let i,d,m=null;Oe(async()=>{d=await n();const{editor:b}=d;m=b.createModel(a.modelValue,a.mod),r.value&&(d.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,allowComments:!0,schemaValidation:"error"}),i=b.create(r.value,C.merge({model:m,tabSize:4,automaticLayout:!0,foldingStrategy:"indentation",scrollBeyondLastLine:!1,glyphMargin:!1,folding:!0,scrollbar:{alwaysConsumeMouseWheel:!1},minimap:{enabled:!1}},a.options)),i.onDidChangeModelContent(()=>{const h=i.getValue();l("update:modelValue",h)}),i.onDidContentSizeChange(()=>{const h=Math.min(1500,i.getContentHeight());r.value.style.height=`${h}px`,i.layout()}),i.onDidBlurEditorWidget(()=>{v(),l("blur",{editor:i,markers:d.editor.getModelMarkers({})})}))});let f=[];const v=()=>{const b=d.editor.getModelMarkers({});return b.length>0?(i.revealLineInCenter(b[0].endLineNumber),f=i.deltaDecorations(f,[{range:new d.Range(b[0].endLineNumber,1,b[0].endLineNumber,1),options:{isWholeLine:!0,className:"myContentClass",glyphMarginClassName:"myGlyphMarginClass"}}]),ve("myGlyphMarginClass"),!1):(i.deltaDecorations(f,[]),!0)};return t({validate:v}),ht(()=>{i&&i.dispose()}),(b,h)=>(u(),g("div",{ref_key:"dom",ref:r,class:"editor"},null,512))}},Pe=D(la,[["__scopeId","data-v-a25f8e4f"]]),gt=A({__name:"VJson",props:{modelValue:{type:[String,Object,Array],default:void 0},disabled:{type:Boolean,default:!1},validateEvent:{type:Boolean,default:!0}},emits:["update:modelValue","blur"],setup(e,{expose:t,emit:l}){const a=e.modelValue||"",o=q(a),s=_(o?a:JSON.stringify(a,null,2)),n=()=>{l("update:modelValue",o?s.value:JSON.parse(s.value))},r=_();return t({validate:()=>r.value.validate()}),(i,d)=>(u(),c(Pe,{ref_key:"editor",ref:r,modelValue:I(s),"onUpdate:modelValue":[d[0]||(d[0]=m=>ie(s)?s.value=m:null),n],mod:"json"},null,8,["modelValue"]))}}),aa={name:"VIconSelect",props:{options:{type:Array,default:()=>[]},modelValue:{type:String,default:""},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{filter:"",showIcons:!1,localValue:this.$props.modelValue,elIconList:[],key:0}},beforeCreate(){fetch("http://assest.daodao.run/element-plus-icons.json").then(e=>e.json()).then(e=>{this.elIconList=e}).catch(function(){})},methods:{onselected(e){this.localValue=e,this.key++,this.$emit("update:modelValue",this.localValue),this.$refs.popover.hide()},focus(){}}};function oa(e,t,l,a,o,s){const n=B("v-icon"),r=Ce,i=Y,d=W,m=ol,f=sl;return u(),c(f,{ref:"popover",placement:"bottom-start",trigger:"click",width:650},{reference:p(()=>[y(r,{modelValue:o.localValue,"onUpdate:modelValue":t[0]||(t[0]=v=>o.localValue=v),disabled:l.disabled,style:{width:"60%"},onFocus:s.focus},{prepend:p(()=>[(u(),c(n,{key:o.key,name:o.localValue||""},null,8,["name"]))]),_:1},8,["modelValue","disabled","onFocus"])]),default:p(()=>[y(m,{style:{"max-height":"300px",overflow:"auto"}},{default:p(()=>[y(r,{modelValue:o.filter,"onUpdate:modelValue":t[1]||(t[1]=v=>o.filter=v),placeholder:"搜索...",onFocus:s.focus},null,8,["modelValue","onFocus"]),y(d,{class:"icon-list"},{default:p(()=>[(u(!0),g(j,null,F(o.elIconList.filter(v=>v.indexOf(o.filter)!==-1),(v,b)=>(u(),c(i,{key:b,span:2,onClick:h=>s.onselected(v)},{default:p(()=>[y(n,{class:H({"icon-cell":!0,active:v===o.localValue}),name:v},null,8,["class","name"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},512)}const sa=D(aa,[["render",oa],["__scopeId","data-v-ffed56d6"]]),na=A({name:"VSubForm",components:{Plus:$e,Minus:pt,VForm:Z(()=>Promise.resolve().then(()=>Bt))},inject:["formData","dev","mod"],props:{repeat:{type:Boolean,default:!1},max:{type:Number,default:100},formItems:{type:Array,default:()=>[]},modelValue:{type:[Object,Array],default:()=>({})},disabled:{type:Boolean,default:!1},options:{type:Object,default:()=>({})}},emits:["update:modelValue"],data(){let e=[];const t=C.cloneDeep(this.$props.modelValue);return this.$props.repeat===!0&&T(this.$props.modelValue)?e=t:this.$props.repeat===!1&&J(this.$props.modelValue)?e.push(t):e.push({}),e.length===0&&e.push({}),{key:1,fApis:[],sub:e,formOptions:C.merge(this.$props.options,{submitButton:!1,cancelButton:!1,disabled:this.disabled})}},watch:{$props:{immediate:!0,handler(e){e.repeat===!0&&!T(e.modelValue)&&console.error("sub-form type is repeat: modelValue must is array"),e.repeat===!1&&!J(e.modelValue)&&console.error("sub-form type is single: modelValue must is Object")}}},methods:{push(){this.sub.push({})},remove(e){this.sub=C.remove(this.sub,(t,l)=>l!==e),this.key++,this.$emit("update:modelValue",this.repeat?this.sub:this.sub[0])},onchange(){this.$emit("update:modelValue",this.repeat?this.sub:this.sub[0])},subMounted(e,t){this.fApis[t]=e},validate:async function(){let e=!0;for(let t=0;t<this.fApis.length;t++){const l=this.fApis[t];if(!e)return!1;await l.validate()||(e=!1)}return e},getRootData(){return this.formData}}}),ia={class:"sub-form"},ra={class:"box"},ua={class:"box"};function da(e,t,l,a,o,s){const n=B("v-form"),r=Y,i=B("Minus"),d=Q,m=z,f=B("Plus"),v=W;return u(),g("div",ia,[(u(!0),g(j,null,F(e.sub,(b,h)=>(u(),c(v,{key:h+"-"+e.key},{default:p(()=>[y(r,{class:"sub-form-item",span:e.repeat?22:24},{default:p(()=>[y(n,{ref_for:!0,ref:"subForm"+h,modelValue:e.sub[h],"onUpdate:modelValue":[w=>e.sub[h]=w,e.onchange],"is-sub":!0,options:e.formOptions,"form-items":e.$props.formItems,"root-data":e.getRootData,disable:e.disabled,mod:e.mod,onMounted:w=>e.subMounted(w,h)},null,8,["modelValue","onUpdate:modelValue","options","form-items","root-data","disable","mod","onMounted"])]),_:2},1032,["span"]),e.repeat&&!e.disabled?(u(),c(r,{key:0,span:2},{default:p(()=>[x("div",ra,[e.sub.length>1?(u(),c(m,{key:0,type:"danger",circle:"",size:"small",onClick:w=>e.remove(h)},{icon:p(()=>[y(d,null,{default:p(()=>[y(i)]),_:1})]),_:2},1032,["onClick"])):V("",!0)]),x("div",ua,[h===e.sub.length-1&&e.sub.length<e.max?(u(),c(m,{key:0,type:"primary",size:"small",circle:"",onClick:e.push},{icon:p(()=>[y(d,null,{default:p(()=>[y(f)]),_:1})]),_:1},8,["onClick"])):V("",!0)])]),_:2},1024)):V("",!0)]),_:2},1024))),128))])}const pa=D(na,[["render",da],["__scopeId","data-v-0f559968"]]),ca={components:{Plus:$e},inject:["formData"],props:{modelValue:{type:[Array,String],default:()=>[]},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},action:{type:String,default:"#"},headers:{type:Object,default:()=>{}},limit:{type:Number,default:1},accept:{type:String,default:""},format:{type:Array,default:e=>[]},maxSize:{type:Number,default:0},type:{type:String,default:"image"}},emits:["update:modelValue"],data(){return{delIcon:!1,dialogImageUrl:"",dialogVisible:!1,fileList:Rt(this.$props.modelValue).map(this.parseFile),tip:"",tempIndex:1,reqHeaders:Object.assign($t(),this.$props.headers)}},mounted(){setTimeout(()=>{this.uploadAction()},20),this.addDownloadIcon()},methods:{addDownloadIcon(){this.$refs.upload.$el.getElementsByClassName("el-upload-list__item-actions").forEach((e,t)=>{if(this.delIcon||e.getElementsByClassName("el-icon-download").length)return;const l=document.createElement("span");l.innerHTML='<span class="el-upload-list__item-delete"><i class="iconfont ra-download"></i></span>',l.onclick=()=>{const a=this.fileList[t];Ht(a.url,a.name)},this.delIcon=!0,e.appendChild(l)})},parseFile(e="",t){let l="";return this.fileList&&this.fileList[t]&&this.fileList[t].url===e&&(l=this.fileList[t].uid||Date.now()+this.tempIndex++),{url:e,name:e.split("/").pop(),status:"success",uid:l||Date.now()+this.tempIndex++}},uploadAction(){const e=this.uploadEl();this.fileList&&this.fileList.length>=this.limit?e&&(e.style.display="none"):e&&(e.style.display="inline-block");const t=this.fileList.map(a=>a.url);this.addDownloadIcon();const l=this.limit===1?t[0]??"":t;this.$emit("update:modelValue",l)},handleRemove(e,t){this.fileList=t,this.uploadAction()},preview(e){if(e.status!=="success")return!1;this.dialogImageUrl=e.url,this.dialogVisible=!0},beforeUpload(e){const{format:t,maxSize:l}={format:this.format,maxSize:this.maxSize},{name:a,size:o}=e;return t&&t.length>0&&t.indexOf(a.split(".").reverse()[0])===-1?(this.$message.warning(`格式错误，仅支持后缀名为 ${t.join("、")} 的文件!`),!1):l&&l<o/1024?(this.$message.warning(`文件大小不能超过 ${l}KB !`),!1):!0},onExceed(){this.$message.warning(`最多只能上传${this.limit}个`)},uploadEl(){if(this.$refs.upload)return this.$refs.upload.$el.getElementsByClassName("el-upload")[0]},onError(e,t,l){this.$notify.error({title:"上传失败",message:e})},onSuccess(e,t,l){var a;if(e.code!==0){this.$notify.error({title:e.message||"上传失败.",message:t.name}),this.fileList=C.remove(l,s=>s.response.code===0);return}const o=(a=e.data)==null?void 0:a.url;if(!o){this.$notify.error({message:"上传接口错误"});return}t.url=o,l[0].url=o,this.fileList=l,this.uploadAction()},httpRequest(e){return new Promise((t,l)=>{const a=new FormData;a.append("file",e.file),this.$http.create().request({url:P(e.action,this.formData),method:e.method,data:a,headers:{"Content-Type":"multipart/form-data",...e.headers}}).then(o=>{t(o.data)}).catch(o=>{l(o)})})}}},ma=["innerHTML"];function ha(e,t,l,a,o,s){const n=B("plus"),r=Q,i=z,d=nl,m=st,f=oe;return u(),g(j,null,[y(d,{ref:"upload",class:"uploader ok",action:l.action,"list-type":l.type==="image"?"picture-card":"text",limit:l.limit,multiple:l.limit>1,"file-list":o.fileList,disabled:l.disabled,"before-upload":s.beforeUpload,"on-preview":s.preview,"on-remove":s.handleRemove,"on-exceed":s.onExceed,"on-success":s.onSuccess,"on-error":s.onError,headers:o.reqHeaders,"http-request":s.httpRequest},me({tip:p(()=>[x("div",{innerHTML:o.tip},null,8,ma)]),_:2},[o.fileList.length<l.limit?{name:"default",fn:p(()=>[l.type==="image"?(u(),c(r,{key:0,class:"uploader-icon"},{default:p(()=>[y(n)]),_:1})):V("",!0),l.type==="file"?(u(),c(i,{key:1,size:"small",type:"primary"},{default:p(()=>[$("点击上传")]),_:1})):V("",!0)]),key:"0"}:void 0]),1032,["action","list-type","limit","multiple","file-list","disabled","before-upload","on-preview","on-remove","on-exceed","on-success","on-error","headers","http-request"]),y(f,{modelValue:o.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=v=>o.dialogVisible=v)},{default:p(()=>[y(m,{src:o.dialogImageUrl,lazy:""},null,8,["src"])]),_:1},8,["modelValue"])],64)}const vt=D(ca,[["render",ha]]),fa={mounted(e,t){t.value&&xl(t.value).mask(e.getElementsByTagName("input")[0])}},ba=A({directives:{mask:fa},props:{modelValue:{type:[String,Number,Object,Array],default:""},showWordLimit:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},autosize:{type:[Boolean,Object],default:()=>({minRows:2})},rows:{type:Number,default:6},showCopy:{type:Boolean,default:!1},showPassword:{type:Boolean,default:!1},mask:{type:[String,Object],default:""},placeholder:{type:String,default:""},type:{type:String,default:""}},emits:["change","blur","clear","input","inputNative","copy","focus","update:modelValue"],data(){return{inputValue:""}},watch:{modelValue:{handler:function(e){this.inputValue=e||""},immediate:!0}},created(){},methods:{updateModel(e){this.$emit("update:modelValue",e)},change(e){this.$emit("change",e)},blur(e){this.$emit("blur",e)},focus(e){this.$emit("focus",e)},clear(){this.$emit("clear")},input(){this.$emit("input",this.inputValue)},copy(){Ze(this.inputValue),this.$emit("copy")}}});function ya(e,t,l,a,o,s){const n=z,r=Ce,i=mt("mask");return G((u(),c(r,L({modelValue:e.inputValue,"onUpdate:modelValue":t[0]||(t[0]=d=>e.inputValue=d),"show-word-limit":e.showWordLimit,rows:e.rows,clearable:e.clearable,disabled:e.disabled,"show-password":e.showPassword,type:e.type},e.$attrs,{autosize:e.autosize,placeholder:e.placeholder,onChange:e.change,onFocus:e.focus,onClear:e.clear,onBlur:e.blur,onInput:e.input,"onUpdate:modelValue":e.updateModel}),me({_:2},[e.showCopy?{name:"append",fn:p(()=>[e.showCopy?(u(),c(n,{key:0,icon:"el-icon-copy-document",onClick:e.copy},null,8,["onClick"])):V("",!0)]),key:"0"}:void 0]),1040,["modelValue","show-word-limit","rows","clearable","disabled","show-password","type","autosize","placeholder","onChange","onFocus","onClear","onBlur","onInput","onUpdate:modelValue"])),[[i,e.mask]])}const wt=D(ba,[["render",ya],["__scopeId","data-v-740439c4"]]),ga=A({name:"VCascader",props:{options:{type:Array,default:()=>[]},modelValue:{type:[Array,Number],default:void 0},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},showAllLevels:{type:Boolean,default:!0},collapseTags:{type:Boolean,default:!1},filterable:{type:Boolean,default:!0},props:{type:Object,default:e=>{}},size:{type:String,default:""},optionsApi:{type:String,default:""},saveAs:{type:String,default:"array"}},emits:["update:modelValue"],setup(e,{emit:t}){const l=_(C.cloneDeep(fe(e.modelValue)?[e.modelValue]:e.modelValue)),a=_(e.options),o=_(0),s=ne(),n=s==null?void 0:s.appContext.config.globalProperties.$http;return Ae(()=>{e.optionsApi&&n.request({method:"GET",url:e.optionsApi}).then(({data:r})=>{a.value=r||[],fe(e.modelValue)&&(l.value=Ut(a.value,e.modelValue,e.props.value||"value")),o.value++})}),{localValue:l,optionTree:a,onchange:()=>{let r=l;fe(e.modelValue)&&(r=l.value[l.value.length-1]),e.saveAs==="array"?r=l.value:e.saveAs==="number"&&(r=l.value[l.value.length-1]),t("update:modelValue",r)},key:o}}});function va(e,t,l,a,o,s){const n=il;return u(),c(n,{key:e.key,modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=r=>e.localValue=r),options:e.optionTree,disabled:e.disabled,clearable:e.clearable,"show-all-levels":e.showAllLevels,"collapse-tags":e.collapseTags,filterable:e.filterable,props:e.props,size:e.size,onChange:e.onchange},null,8,["modelValue","options","disabled","clearable","show-all-levels","collapse-tags","filterable","props","size","onChange"])}const wa=D(ga,[["render",va]]),Vt=e=>{let t=[];return e.forEach(l=>{t.push(l.value),l.children!==void 0&&(t=t.concat(Vt(l.children)))}),t},kt=(e,t)=>{let l=[];for(let a=0;a<t.length;a++){const o=t[a];if(o.value===e){o.children!==void 0?l=l.concat(Vt(o.children)):l.push(o.value);continue}o.children!==void 0&&(l=l.concat(kt(e,o.children)))}return l},Va=(e,t)=>{let l=[];return e.forEach(a=>{l=l.concat(kt(a,t))}),l},ka=A({props:{modelValue:{type:Array,default:()=>[]},options:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},showAllLevels:{type:Boolean,default:!0},collapseTags:{type:Boolean,default:!1},filterable:{type:Boolean,default:!0},props:{type:Object,default:e=>{}},size:{type:String,default:""},optionsApi:{type:String,default:""}},emits:["update:modelValue"],setup(e,t){const{$http:l}=Te(),a=_([]),o=_([]);Ae(async()=>{if(e.optionsApi){const{data:r}=await l.get(e.optionsApi);a.value=r||[]}else a.value=e.options;e.props.emitPath?o.value=e.modelValue:o.value=Va(e.modelValue,a.value)});const s=r=>{if(e.props.emitPath)t.emit("update:modelValue",r);else{const i=[];n.value.getCheckedNodes().forEach(d=>{d.parent&&d.parent.checked||i.push(d.value)}),t.emit("update:modelValue",i)}},n=_(null);return{localVal:o,onchange:s,cas:n,optionsTree:a}}});function Ca(e,t,l,a,o,s){const n=rl;return u(),c(n,{ref:"cas",modelValue:e.localVal,"onUpdate:modelValue":t[0]||(t[0]=r=>e.localVal=r),options:e.optionsTree,disabled:e.disabled,clearable:e.clearable,"show-all-levels":e.showAllLevels,"collapse-tags":e.collapseTags,filterable:e.filterable,props:e.props,size:e.size,onChange:e.onchange},null,8,["modelValue","options","disabled","clearable","show-all-levels","collapse-tags","filterable","props","size","onChange"])}const Ct=D(ka,[["render",Ca]]),Sa=A({name:"VFilter",components:{FormItem:Z(()=>Promise.resolve().then(()=>At)),draggable:_l},inject:["formData","dev"],props:{formItems:{type:Array,default:()=>[]},modelValue:{type:Array||null,default:()=>[]},disabled:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},showLabel:{type:Boolean,default:!0}},emits:["update:modelValue"],data(){const e=this.$props.modelValue?this.$props.modelValue:[];e.length===0&&e.push({field:"",value:void 0});const t=[];return this.$props.formItems.forEach(l=>{t.push({value:l.field,label:l.label})}),{key:1,fApis:[],sub:e,localOptions:t,formOptions:C.merge(this.$props.options,{submitButton:!1,cancelButton:!1}),plus:We($e),minus:We(pt)}},computed:{itemKey(){return Object.keys(this.$props.formItems[0]|{})[0]}},methods:{push(){this.sub.push({field:void 0,value:void 0})},remove(e){this.sub=C.remove(this.sub,(t,l)=>l!==e),this.key++,this.$emit("update:modelValue",this.sub)},onchange(){const e=[];this.sub.forEach(t=>{t.value!==void 0&&e.push({field:t.field,value:t.value})}),this.$emit("update:modelValue",e)},subMounted(e,t){this.fApis[t]=e},validate(){let e=!0;return this.fApis.forEach(t=>{if(!e)return!1;t.validate(l=>{l||(e=!1)})}),e},getRootData(){return this.formData},getFormitem(e){const t=this.sub[e].field;let l={};return this.$props.formItems.forEach(a=>{a.field===t&&(l=a)}),l},fieldChange(e){this.sub[e].id===void 0?this.sub[e].id=1:this.sub[e].id+=1},onFiledChange(){},allowOptions(e){const t=[];return this.sub.forEach((l,a)=>{a<e&&t.push(l.field)}),C.filter(this.localOptions,l=>t.indexOf(l.value)<0)}}}),xa={class:"sub-form"},_a={key:0};function $a(e,t,l,a,o,s){const n=Ve,r=ke,i=Y,d=B("form-item"),m=W,f=z,v=B("draggable");return u(),g("div",xa,[y(v,{modelValue:e.sub,"onUpdate:modelValue":t[0]||(t[0]=b=>e.sub=b),group:"filter","item-key":e.itemKey,disabled:e.disabled,onStart:t[1]||(t[1]=b=>e.drag=!0),onEnd:t[2]||(t[2]=b=>e.drag=!1)},{item:p(({element:b,index:h})=>[y(m,null,{default:p(()=>[y(i,{class:"sub-form-item",span:22},{default:p(()=>[y(m,null,{default:p(()=>[e.showLabel?(u(),c(i,{key:0,span:4},{default:p(()=>[y(r,{modelValue:e.sub[h].field,"onUpdate:modelValue":w=>e.sub[h].field=w,disabled:e.$props.disabled||h<e.sub.length-1,onChange:()=>e.fieldChange(h)},{default:p(()=>[(u(!0),g(j,null,F(e.allowOptions(h),w=>(u(),c(n,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:2},1024)):V("",!0),y(i,{span:16},{default:p(()=>[e.sub[h].field?(u(),c(d,{key:0,modelValue:e.sub[h].value,"onUpdate:modelValue":[w=>e.sub[h].value=w,e.onchange],item:e.getFormitem(h),"form-options":{disabled:e.$props.disabled}},null,8,["modelValue","onUpdate:modelValue","item","form-options"])):V("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),e.disabled?V("",!0):(u(),c(i,{key:0,span:2,class:"sub-form-item-action"},{default:p(()=>[x("div",null,[x("div",null,[e.sub.length>1?(u(),c(f,{key:0,class:"action",type:"danger",icon:e.minus,circle:"",onClick:w=>e.remove(h)},null,8,["icon","onClick"])):V("",!0)]),h===e.sub.length-1&&h<e.formItems.length-1?(u(),g("div",_a,[e.allowOptions(h).length>1?(u(),c(f,{key:0,class:"action",type:"primary",icon:e.plus,circle:"",onClick:e.push},null,8,["icon","onClick"])):V("",!0)])):V("",!0)])]),_:2},1024))]),_:2},1024)]),_:1},8,["modelValue","item-key","disabled"])])}const Oa=D(Sa,[["render",$a],["__scopeId","data-v-ce9ff07b"]]),Aa=A({name:"VShow",inject:["formData"],props:{tpl:{type:[String,Array,Object],default:""},dataApi:{type:String,default:""},watch:{type:String,default:""},auto:{type:Boolean,default:!0},text:{type:String,default:"查询"},interval:{type:Number,default:0},timeout:{type:Number,default:0}},data(){if(this.auto){const e=C.debounce(t=>{this.request(t)},300);this.$watch(this.$props.watch?`formData.${this.$props.watch}`:"formData",e,{deep:!0,immediate:!0})}return{showTpl:"",key:0,loading:!1,instance:void 0,usTime:0}},beforeUnmount(){this.instance&&clearInterval(this.instance)},methods:{getTpl(e){if(T(this.tpl)){for(let t=0;t<this.tpl.length;t++)if(ee(this.formData,this.tpl[t].when))return this.makeTpl(this.tpl[t].tpl,e||this.formData);return""}return this.makeTpl(this.tpl,e||this.formData)},makeTpl(e,t){return(l=>l.indexOf("function(")===0)(e)?new Function("return "+e)()(t||this.formData):e},requestApi(e,t){t&&(this.loading=!0);try{this.$http({method:"GET",url:P(this.$props.dataApi,{...this.formData})}).then(({data:l})=>{const a=Object.assign({},e,l);this.showTpl=P(this.getTpl(a),a),this.$props.interval&&l.state==="done"&&(clearInterval(this.instance),this.instance=void 0,this.usTime=0,this.loading=!1),t&&(this.loading=!1)}).catch(l=>{console.log(l),t&&(this.loading=!1),this.$props.interval&&(clearInterval(this.instance),this.instance=void 0,this.usTime=0,this.loading=!1)})}catch{t&&(this.loading=!1)}},request(e){this.$props.dataApi?this.$props.interval?(this.loading=!0,this.instance=setInterval(async()=>{if(this.$props.timeout>0&&this.usTime>=this.$props.timeout){clearInterval(this.instance),this.instance=void 0,this.$message.error("查询超时, 请重试");return}await this.requestApi(e),this.usTime+=this.$props.interval},this.$props.interval)):this.requestApi(e,!0):this.showTpl=P(this.getTpl(),e),this.key++}}}),Ba=["innerHTML"];function Da(e,t,l,a,o,s){const n=z;return u(),g("div",null,[e.loading?V("",!0):(u(),g("span",{key:e.key,innerHTML:e.showTpl},null,8,Ba)),e.auto?V("",!0):(u(),c(n,{key:1,loading:e.loading,onClick:t[0]||(t[0]=()=>e.request({}))},{default:p(()=>[$(O(e.text),1)]),_:1},8,["loading"]))])}const ja=D(Aa,[["render",Da]]),Ea=A({__name:"VDate",props:{disabledDate:{type:[Function,Array],default:()=>e=>!1}},setup(e){const t=e,l=a=>{if(N(t.disabledDate))return t.disabledDate(a);const o=t.disabledDate;if(T(o[0])){for(let s=0;s<o.length;s++)if(qe(a,Ke(o[s][1]),o[s][0]))return!0}else{const s=o;if(qe(a,Ke(s[1]),s[0]))return!0}return!1};return(a,o)=>{const s=ul;return u(),c(s,{"disabled-date":l})}}}),Ta={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 400 400"},Pa=x("g",{fill:"none","fill-rule":"evenodd"},[x("path",{d:"M0 0h400v400H0z"}),x("path",{fill:"currentColor",d:"M310 132v30h-96v75.5h96.5v30h-107v-.5H184V162H89v-30h221Z"}),x("circle",{cx:"200",cy:"200",r:"199",stroke:"#000","stroke-opacity":".546","stroke-width":"2"})],-1),Ia=[Pa];function Fa(e,t){return u(),g("svg",Ta,Ia)}const La={render:Fa},Ma={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 400 400"},Na=x("g",{fill:"none","fill-rule":"evenodd"},[x("path",{d:"M0 0h400v400H0z"}),x("circle",{cx:"200",cy:"200",r:"197.5",stroke:"#000","stroke-opacity":".546","stroke-width":"5"}),x("path",{fill:"currentColor",d:"M215 74v105h105v30H215v105h-30l-.001-105H80v-30h105V74h30Z"})],-1),Ra=[Na];function Ha(e,t){return u(),g("svg",Ma,Ra)}const Ua={render:Ha},za={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 400 400"},qa=x("g",{fill:"none","fill-rule":"evenodd",transform:"rotate(90 200 200)"},[x("path",{d:"M0 0h400v400H0z"}),x("circle",{cx:"200",cy:"200",r:"197.5",stroke:"#000","stroke-opacity":".546","stroke-width":"5"}),x("path",{fill:"currentColor",d:"M185 314V74h30v240z"})],-1),Ka=[qa];function Ya(e,t){return u(),g("svg",za,Ka)}const Wa={render:Ya},Ga=A({components:{SvgGroup:La,SvgAdd:Ua,SvgRemove:Wa,FormItem:Z(()=>Promise.resolve().then(()=>At))},props:{rule:{type:Object,default:e=>{}},formItems:{type:Array,default:e=>[]},factorOptions:{type:Array,default:e=>[]},addChildVisible:{type:Boolean,default:!0},maxDepth:{type:Number,default:3},deep:{type:Number,default:1},disabled:{type:Boolean,default:!1},ctrl:{type:Object,default:()=>{}}},emits:["add","addChild","delete","change"],data(){return{rules:{field:[{required:!0,message:"请选择",trigger:"change"}],operator:[{required:!0,message:"请选择",trigger:"change"}],value:[{required:!0,message:"请输入",trigger:["blur","change"]}]},defaultOperatorOptions:[{value:"=",label:"等于"},{value:">",label:"大于"},{value:"<",label:"小于"},{value:">=",label:"大于等于"},{value:"<=",label:"小于等于"},{value:"!=",label:"不等于"},{value:"in",label:"在其中"},{value:"not in",label:"不在其中"},{value:"has",label:"包含"},{value:"not has",label:"不包含"}],operatorOptions:[],valueKey:0}},watch:{rule:{handler(e){this.operatorOptions=[],this.formItems.forEach(t=>{t.field===e.field&&t.operatorOptions!==void 0&&(this.operatorOptions=t.operatorOptions)}),this.operatorOptions.length===0&&(this.operatorOptions=this.defaultOperatorOptions)},immediate:!0,deep:!0}},methods:{async validate(){return this.$refs._form.validate()},addRow(){this.$emit("add")},addChild(){this.$emit("addChild")},deleteRow(){this.$emit("delete")},change(e){this.$emit("change",e)},getFormItem(){const e=this.rule.field;let t={};return this.$props.formItems.forEach(l=>{l.field===e&&(t={...l})}),t.props=t.props||{},t.props.disabled=this.disabled,t}}}),Ja={class:"ruleFields"};function Qa(e,t,l,a,o,s){const n=Ve,r=ke,i=_e,d=Y,m=B("FormItem"),f=B("SvgGroup"),v=se,b=Q,h=B("SvgRemove"),w=B("SvgAdd"),S=W,k=xe;return u(),g("div",Ja,[(u(),c(k,{ref:"_form",key:e.rule.field,model:e.rule,rules:e.rules,inline:"",size:"small"},{default:p(()=>[y(S,null,{default:p(()=>[y(d,{span:6},{default:p(()=>[y(i,{prop:"field"},{default:p(()=>[y(r,{modelValue:e.rule.field,"onUpdate:modelValue":t[0]||(t[0]=E=>e.rule.field=E),placeholder:"请选择",filterable:"",disabled:e.disabled,onChange:t[1]||(t[1]=()=>e.change("field"))},{default:p(()=>[(u(!0),g(j,null,F(e.factorOptions,(E,M)=>(u(),c(n,{key:M,label:E.label,value:E.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),y(d,{span:6},{default:p(()=>[y(i,{prop:"operator"},{default:p(()=>[y(r,{modelValue:e.rule.operator,"onUpdate:modelValue":t[2]||(t[2]=E=>e.rule.operator=E),placeholder:"符号",disabled:e.disabled,onChange:t[3]||(t[3]=()=>e.change("operator"))},{default:p(()=>[(u(!0),g(j,null,F(e.operatorOptions,(E,M)=>(u(),c(n,{key:M,label:E.label,value:E.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),y(d,{span:6},{default:p(()=>[y(i,{prop:"value"},{default:p(()=>[(u(),c(m,{key:e.valueKey,modelValue:e.rule.value,"onUpdate:modelValue":[t[4]||(t[4]=E=>e.rule.value=E),t[5]||(t[5]=()=>e.change("value"))],"show-label":!1,item:e.getFormItem(),disabled:e.disabled},null,8,["modelValue","item","disabled"]))]),_:1})]),_:1}),e.disabled?V("",!0):(u(),c(d,{key:0,span:6,style:{"text-align":"right"}},{default:p(()=>[e.deep<=e.maxDepth&&e.ctrl.addSub?(u(),c(b,{key:0,size:"mini",color:"#67C23A"},{default:p(()=>[y(v,{placement:"top-start",content:"添加规则组"},{default:p(()=>[y(f,{style:{color:"green",padding:"2px"},onClick:e.addChild},null,8,["onClick"])]),_:1})]),_:1})):V("",!0),e.ctrl.del?(u(),c(b,{key:1,size:"mini",color:"#F56C6C"},{default:p(()=>[y(v,{placement:"top-start",content:"删除"},{default:p(()=>[y(h,{style:{color:"red",padding:"2px"},onClick:e.deleteRow},null,8,["onClick"])]),_:1})]),_:1})):V("",!0),e.ctrl.addBrother?(u(),c(b,{key:2,size:"mini",color:"#909399"},{default:p(()=>[y(v,{placement:"top-start",content:"添加同层规则"},{default:p(()=>[y(w,{style:{color:"gray",padding:"2px"},onClick:e.addRow},null,8,["onClick"])]),_:1})]),_:1})):V("",!0)]),_:1}))]),_:1})]),_:1},8,["model","rules"]))])}const Xa=D(Ga,[["render",Qa],["__scopeId","data-v-700634d0"]]),Za={props:{root:{type:Boolean,default:!1},left:{type:Boolean,default:!1},modelValue:{type:String,default:"and"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{localValue:""}},watch:{modelValue:{handler(e){this.localValue=e},immediate:!0,deep:!0}},methods:{onclick(){this.localValue=this.localValue==="and"?"or":"and",this.$emit("update:modelValue",this.localValue)}}},eo=e=>(De("data-v-2bd34a41"),e=e(),je(),e),to={key:0,class:"logic"},lo={key:1},ao=eo(()=>x("div",{class:"line"},null,-1));function oo(e,t,l,a,o,s){return u(),g("div",{class:H("ident "+(l.left?"line-left":""))},[l.root?V("",!0):(u(),g("div",to,[l.disabled?(u(),g("span",lo,O(o.localValue==="and"?"且":"或"),1)):(u(),g("i",{key:0,class:H("iconfont "+(o.localValue==="and"?"ra-and":"ra-or")),onClick:t[0]||(t[0]=(...n)=>s.onclick&&s.onclick(...n))},null,2))])),ao],2)}const so=D(Za,[["render",oo],["__scopeId","data-v-2bd34a41"]]),no={name:"RuleCreate",components:{CirclePlus:Cl,RuleFields:Xa,RuleIdent:so},inject:["formData"],props:{modelValue:{type:Array,default:e=>[]},level:{type:Number,default:e=>1},formItems:{type:Array,default:e=>[]},factoryItems:{type:Array,default:e=>[]},optionsApi:{type:String,default:""},deep:{type:Number,default:1},maxDepth:{type:Number,default:3},disabled:{type:Boolean,default:!1},initValue:{type:Boolean,default:!0},ctrl:{type:Object,default:()=>{}}},emits:["update:modelValue","ruleTextChange"],data(){const e={logic:"and",field:"",operator:""};if(this.$props.optionsApi!==""){const t=zt(this.$props.optionsApi);t.length>0&&t.forEach(l=>{this.$watch(`formData.${l}`,()=>{this.realOptionsApi=P(this.$props.optionsApi,this.formData),this.ruleList=[{...this.defaultConfig}]},{deep:!0,immediate:!0})})}return{validateMessage:"",defaultConfig:e,previewText:"",ruleList:[],factorOptions:this.$props.factoryItems,factoryKey:0,realOptionsApi:P(this.$props.optionsApi,this.formData),realFormItems:this.$props.formItems}},watch:{modelValue:{handler(e){Array.isArray(e)&&e.length>0?this.ruleList=e:this.initValue&&(this.ruleList=[{...this.defaultConfig}])},immediate:!0,deep:!0},previewText(){this.$emit("ruleTextChange",this.previewText)},realOptionsApi:{handler(e){this.$props.deep===1&&e&&this.$http.get(e).then(({data:t})=>{const l=t||[];this.realFormItems=l,this.makeFactory(l),this.change()})},immediate:!0,deep:!0},formItems:{handler(e){},immediate:!0,deep:!0},realFormItems:{handler(e){},immediate:!0,deep:!0}},mounted(){this.change()},methods:{addOne(){this.ruleList.push({...this.defaultConfig})},makeFactory(e){const t=[];e.forEach(l=>{t.push({value:l.field||"",label:l.label})}),this.factorOptions=t,this.factoryKey++},getKey(){return Math.random().toString(16).slice(2)},addRow(e,t){t.push({...this.defaultConfig}),this.change()},deleteRow(e,t){if(t.length===1&&this.level===1)return this.$message.warning("最少要保留一条！");t.splice(e,1),this.change()},addChild(e,t,l){l.push({...this.defaultConfig,children:[{...this.defaultConfig}]}),this.change()},validate:async function(){var e,t;if(this.$refs._ruleForm){for(let l=0;l<((e=this.$refs._ruleForm)==null?void 0:e.length);l++)if(!await this.$refs._ruleForm[l].validate())return!1}if(this.$refs._ruleCreate){for(let l=0;l<((t=this.$refs._ruleCreate)==null?void 0:t.length);l++)if(!await this.$refs._ruleCreate[l].validate())return!1}return!0},getPreviewText(){const e=(t,l=1)=>{const a=[];return t.forEach((o,s)=>{if(o.children&&o.children.length>0){a.push([o.logic,"(",e(o.children,l+1),")"].join(" "));return}const n=this.realFormItems.filter(r=>r.field===o.field)[0];a.push([s===0?"":o.logic,n?n.label:"",o.operator,o.value].filter(r=>r!=="").join(" "))}),a.join(" ")};this.previewText=e(this.ruleList,1)},change(e,t){this.level===1&&this.getPreviewText(),e==="field"&&t!==void 0&&(this.ruleList[t].operator="",this.ruleList[t].value=void 0),this.$emit("update:modelValue",this.ruleList)},changeRecursive(e){this.change()}}},io={key:0},ro={key:1,class:"rule-row"},uo={key:0,class:"preview"},po={key:1,class:"el-form-item__error"};function co(e,t,l,a,o,s){const n=B("CirclePlus"),r=Q,i=B("RuleIdent"),d=Y,m=B("RuleCreate"),f=B("RuleFields"),v=W;return o.ruleList.length===0?(u(),g("div",io,[l.disabled?V("",!0):(u(),c(r,{key:0,onClick:s.addOne},{default:p(()=>[y(n)]),_:1},8,["onClick"]))])):(u(),g("div",{key:1,class:H({_ruleCreate_root:l.level===1})},[(u(!0),g(j,null,F(o.ruleList,(b,h)=>(u(),c(v,{key:`root${h}`,class:"rule-cell"},{default:p(()=>[y(d,{span:2},{default:p(()=>[y(i,{modelValue:b.logic,"onUpdate:modelValue":[w=>b.logic=w,s.change],root:h===0,left:o.ruleList.length>1,disabled:l.disabled},null,8,["modelValue","onUpdate:modelValue","root","left","disabled"])]),_:2},1024),y(d,{span:22},{default:p(()=>[b.children&&b.children.length>0?(u(),c(m,{key:`child${o.factoryKey}`,ref_for:!0,ref:"_ruleCreate",modelValue:b.children,"onUpdate:modelValue":[w=>b.children=w,s.changeRecursive],class:H(["_child_root",{"last-row-child":h===o.ruleList.length-1}]),disabled:l.disabled,level:l.level+1,"factory-items":o.factorOptions,"form-items":o.realFormItems,deep:l.deep+1},null,8,["modelValue","onUpdate:modelValue","disabled","class","level","factory-items","form-items","deep"])):(u(),g("div",ro,[(u(),c(f,{ref_for:!0,ref:"_ruleForm",key:o.factoryKey,rule:b,"add-child-visible":l.level===1,"form-items":o.realFormItems,"factor-options":o.factorOptions,disabled:l.disabled,"max-depth":l.maxDepth,deep:l.deep+1,ctrl:{addSub:!0,addBrother:!0,del:!0,...l.ctrl},onAddChild:w=>s.addChild(h,b,o.ruleList),onDelete:w=>s.deleteRow(h,o.ruleList),onAdd:w=>s.addRow(h,o.ruleList),onChange:w=>s.change(w,h)},null,8,["rule","add-child-visible","form-items","factor-options","disabled","max-depth","deep","ctrl","onAddChild","onDelete","onAdd","onChange"]))]))]),_:2},1024)]),_:2},1024))),128)),l.level===1?(u(),g("div",uo,"规则预览："+O(o.previewText),1)):V("",!0),l.level===1?(u(),g("div",po,O(o.validateMessage),1)):V("",!0)],2))}const St=D(no,[["render",co],["__scopeId","data-v-33709c91"]]);function Qe(e){return e.length===0?0:parseInt(e.join(""),2)}function mo(e){return e.toString(2).split("")}const ho=A({name:"VPointCheckbox",props:{options:{type:Array,default:()=>[]},modelValue:{type:Number,default:0},disabled:{type:Boolean,default:!1},min:{type:Number,default:void 0},max:{type:Number,default:void 0}},emits:["update:modelValue"],data(){const e=mo(this.$props.modelValue).reverse(),t=[];return e.forEach((l,a)=>{l==="1"&&t.push(a)}),{localValue:t}},methods:{onchange(){const e=this.$props.options.map(l=>l.value);let t=Array(Math.max(...e)).fill("0");this.localValue.forEach(l=>{t[l]="1"}),t=t.reverse(),console.log(12333,t.join(""),Qe(t)),this.$emit("update:modelValue",Qe(t))}}});function fo(e,t,l,a,o,s){const n=tt,r=lt;return u(),c(r,{modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=i=>e.localValue=i),max:e.max,min:e.min,onChange:e.onchange},{default:p(()=>[(u(!0),g(j,null,F(e.options,(i,d)=>(u(),c(n,{key:d+"-checkbox",label:i.value},{default:p(()=>[$(O(i.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","max","min","onChange"])}const bo=D(ho,[["render",fo]]),xt=A({__name:"VNumber",props:{modelValue:{type:Number,default:0},min:{type:[Number,String],default:-1/0}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e,a=U(()=>{if(q(l.min))switch(l.min){case"current":return l.modelValue}return l.min}),o=_(l.modelValue),s=()=>{t("update:modelValue",o.value)};return(n,r)=>{const i=ll;return u(),c(i,{modelValue:I(o),"onUpdate:modelValue":[r[0]||(r[0]=d=>ie(o)?o.value=d:null),s],min:I(a)},null,8,["modelValue","min"])}}}),yo={props:{modelValue:{type:[Number,String],default:""}},emits:["update:modelValue"],data(){return{hours:"",minutes:"",seconds:""}},watch:{modelValue:{handler(e){if(!e){this.hours=this.minutes=this.seconds=0;return}const t=parseInt(e,10);this.hours=Math.floor(t/3600),this.minutes=Math.floor((t-this.hours*3600)/60),this.seconds=t-this.hours*3600-this.minutes*60},immediate:!0}},methods:{handleInput(e,t){let l=0;t==="hours"&&(l=this.calcSeconds(e,this.minutes,this.seconds)),t==="minutes"&&(l=this.calcSeconds(this.hours,e,this.seconds)),t==="seconds"&&(l=this.calcSeconds(this.hours,this.minutes,e)),this.$emit("update:modelValue",l)},calcSeconds(e,t,l){return e*3600+t*60+l}}};function go(e,t,l,a,o,s){const n=Ce,r=Y,i=W;return u(),c(i,{gutter:20},{default:p(()=>[y(r,{span:6},{default:p(()=>[y(n,{modelValue:o.hours,"onUpdate:modelValue":[t[0]||(t[0]=d=>o.hours=d),t[1]||(t[1]=d=>s.handleInput(d,"hours"))],modelModifiers:{number:!0}},{append:p(()=>[$("时")]),_:1},8,["modelValue"])]),_:1}),y(r,{span:6},{default:p(()=>[y(n,{modelValue:o.minutes,"onUpdate:modelValue":[t[2]||(t[2]=d=>o.minutes=d),t[3]||(t[3]=d=>s.handleInput(d,"minutes"))],modelModifiers:{number:!0}},{append:p(()=>[$("分")]),_:1},8,["modelValue"])]),_:1}),y(r,{span:6},{default:p(()=>[y(n,{modelValue:o.seconds,"onUpdate:modelValue":[t[4]||(t[4]=d=>o.seconds=d),t[5]||(t[5]=d=>s.handleInput(d,"seconds"))],modelModifiers:{number:!0}},{append:p(()=>[$("秒")]),_:1},8,["modelValue"])]),_:1})]),_:1})}const vo=D(yo,[["render",go]]),wo=A({__name:"select",props:{source:{type:Array,default:()=>[]},onSelection:{type:Function,default:()=>{}}},setup(e){const t=e,l=Z(()=>Promise.resolve().then(()=>Mt)),a=_({}),o=_("");t.source.length>0&&(o.value=t.source[0].label+"");const s=U(()=>{let r=-1;return t.source.forEach((i,d)=>{i.label===o.value&&(r=d)}),r}),n=r=>{t.onSelection(s.value,r)};return(r,i)=>{const d=rt,m=ut;return u(),c(m,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=f=>o.value=f),type:"card"},{default:p(()=>[(u(!0),g(j,null,F(t.source,(f,v)=>(u(),c(d,{key:v,label:f.label,name:f.label,lazy:!0},{default:p(()=>[y(I(l),{ref_for:!0,ref:a.value[f.value],"show-pagination":!1,"show-normal-button":!1,"show-batch-button":!1,"show-row-button":!1,"show-selection":!0,"sync-url":!1,"info-api":f.infoApi,"list-api":f.listApi,onSelection:n},null,8,["info-api","list-api"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}}),Vo={class:"dialog-footer"},ko=A({__name:"index",props:{modelValue:{type:[String,Number,Array],default:void 0},tableSchema:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},multipleLimit:{type:Number,default:0},effectData:{type:[String,Array,Object],default:()=>{}}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e,a=_([]);Be(()=>l.modelValue,m=>{m&&(a.value=l.multiple?[...m]:[m])},{immediate:!0});const o=m=>{a.value.splice(m,1)},s=_(!1),n=()=>{if(l.multiple===!1&&a.value.length>1){Se.error("只允许选择一个");return}s.value=!1,a.value.length>0&&t("update:modelValue",l.multiple?a.value:a.value[0],Ye(l.effectData,{tab_id:r.value}))},r=_(),i=(m,f)=>{r.value=l.tableSchema[m].id,a.value=f.map(v=>{const b=Ye(l.tableSchema[m].valueKey,v);return q(l.tableSchema[m].valueKey)?b[l.tableSchema[m].valueKey]:b}).filter(v=>v)},d=()=>{s.value=!1,a.value=[],r.value=void 0};return(m,f)=>{const v=we,b=z,h=oe;return u(),g("div",null,[(u(!0),g(j,null,F(a.value,(w,S)=>(u(),c(v,{key:w,class:"mx-1",closable:"","disable-transitions":!1,onClose:k=>o(S)},{default:p(()=>[$(O(w),1)]),_:2},1032,["onClose"]))),128)),e.multiple||a.value.length===0?(u(),c(b,{key:0,class:"button-new-tag ml-1",size:"small",onClick:f[0]||(f[0]=w=>s.value=!0)},{default:p(()=>[$(" + 添加 ")]),_:1})):V("",!0),y(h,{ref:"dialog",modelValue:s.value,"onUpdate:modelValue":f[2]||(f[2]=w=>s.value=w),"append-to-body":!0,"destroy-on-close":!0,"before-close":d,title:"选择",width:"80%"},{footer:p(()=>[x("span",Vo,[y(b,{onClick:f[1]||(f[1]=w=>s.value=!1)},{default:p(()=>[$("取消")]),_:1}),y(b,{type:"primary",onClick:n},{default:p(()=>[$("确定")]),_:1})])]),default:p(()=>[y(wo,{ref:"selectDom",source:e.tableSchema,"on-selection":i},null,8,["source"])]),_:1},8,["modelValue"])])}}}),Co=D(ko,[["__scopeId","data-v-eec61fd9"]]),So={};function xo(e,t){const l=dl;return u(),c(l)}const _o=D(So,[["render",xo]]),ae={input:"v-input",number:"v-number",radio:"v-radio",checkbox:"v-checkbox","number-range":"v-number-range",date:"v-date",daterange:"v-date",time:"el-time-picker",datetime:"el-date-picker",datetimerange:"el-date-picker",slider:"el-slider",image:"v-upload",upload:"v-upload",file:"v-upload",transfer:"el-transfer",color:"el-color-picker",rate:"el-rate",select:"v-select",switch:"v-switch",json:"v-json","icon-select":"v-icon-select","sub-form":"v-sub-form",cascader:"v-cascader","cascader-panel":"v-cascader-panel",rule:"v-rule",filter:"v-filter",show:"v-show",editor:"monaco-editor",code:"monaco-editor",textarea:"el-input","point-checkbox":"v-point-checkbox",duration:"v-duration","table-select":"v-table-select"},$o={inline:!1,labelPosition:"right",labelWidth:"100px",submitButton:{show:!0,type:"primary",showText:"提交"},cancelButton:{show:!0,type:"info",showText:"取消"}};function Oo(e){return e=e||{},pe(e.submitButton)&&(e.submitButton={show:e.submitButton}),pe(e.cancelButton)&&(e.cancelButton={show:e.cancelButton}),C.merge({},$o,e)}const re={VSelect:yt,VRadio:Kl,VCheckbox:Yl,VNumberRange:ta,VJson:gt,VIconSelect:sa,VSubForm:pa,VUpload:vt,VInput:wt,VCascader:wa,VCascaderPanel:Ct,VFilter:Oa,VShow:ja,MonacoEditor:Pe,VRule:St,VPointCheckbox:bo,VNumber:xt,VDuration:vo,VDate:Ea,VTableSelect:Co,VSwitch:_o},Ao=e=>{Object.keys(e).forEach(t=>{re[t]=e[t]})},Ie=e=>(e||(e="input"),ae[e]!==void 0?ae[e]:ae["v-"+e]!==void 0?ae["v-"+e]:e),Fe=(e,t)=>{const l=e.props||{};return t&&t.disabled&&(l.disabled=!0),e.options&&(l.options=e.options),["file","image"].indexOf(e.type)>-1&&(l.action||(l.action="/upload"),l.type=e.type),e.readonly!==void 0&&(l.disabled=!!e.readonly,delete e.readonly),e.disabled!==void 0&&(l.disabled=!!e.disabled,delete e.disabled),e.type!=="color"&&(l.clearable=!0),e.type==="datetime"&&(l.type="datetime",l.format="YYYY-MM-DD HH:mm:ss",l.valueFormat="YYYY-MM-DD HH:mm:ss"),e.type==="date"&&(l.type="date",l.format=l.format||"YYYY-MM-DD",l.valueFormat=l.valueFormat||"YYYY-MM-DD"),e.type==="datetimerange"&&(l.type="datetimerange",l.format=l.format||"YYYY-MM-DD HH:mm:ss",l.valueFormat=l.valueFormat||"YYYY-MM-DD HH:mm:ss",l.startPlaceholder=(e.label||e.field).replace("开始时间","").replace("时间","")+"开始时间",l.endPlaceholder=(e.label||e.field).replace("结束时间","").replace("时间","")+"结束时间"),e.type==="daterange"&&(l.type="daterange",l.format=l.format||"YYYY-MM-DD",l.valueFormat=l.valueFormat||"YYYY-MM-DD",l.startPlaceholder=(e.label||e.field).replace("开始日期","").replace("日期","")+"开始日期",l.endPlaceholder=(e.label||e.field).replace("结束日期","").replace("日期","")+"结束日期"),e.type==="textarea"&&(l.type="textarea"),t&&!t.labelWidth&&(l.placeholder=e.label||e.field),l},_t=(e,t)=>{if(e.value!==void 0){if(e.type==="date"&&q(e.value)&&Qt(e.value)){const{format:l}=Fe(e,t);return $l(Xt(e.value)).format(l)}return e.value}};let $t=()=>({});function Bo(e){$t=e}const Do=A({__name:"FormAction",props:{submiting:{type:Boolean,default:!1},formOptions:{type:Object,default:()=>{}},submitConfirm:{type:[Boolean,Object],default:!1}},emits:["submit","cancel"],setup(e,{emit:t}){const l=e,a=n=>t(n),o=U(()=>{var n,r,i,d;return((r=(n=l.formOptions)==null?void 0:n.submitButton)==null?void 0:r.show)===!0||((d=(i=l.formOptions)==null?void 0:i.cancelButton)==null?void 0:d.show)===!0}),s=()=>{const n={title:l.submitConfirm===!0?"确认提示":l.submitConfirm.title,message:l.submitConfirm===!0?"确认要提交吗?":l.submitConfirm.message};it.confirm(n.message,n.title).then(()=>{a("submit")},()=>{})};return(n,r)=>{const i=z,d=_e;return I(o)?(u(),c(d,{key:0},{default:p(()=>[e.formOptions.submitButton&&e.formOptions.submitButton.show?(u(),c(i,L({key:0,loading:e.submiting},e.formOptions.submitButton,{onClick:r[0]||(r[0]=m=>e.submitConfirm?s():a("submit"))}),{default:p(()=>[$(O(e.formOptions.submitButton.showText),1)]),_:1},16,["loading"])):V("",!0),e.formOptions.cancelButton&&e.formOptions.cancelButton.show?(u(),c(i,L({key:1},e.formOptions.cancelButton,{onClick:r[1]||(r[1]=m=>a("cancel"))}),{default:p(()=>[$(O(e.formOptions.cancelButton.showText),1)]),_:1},16)):V("",!0)]),_:1})):V("",!0)}}});re.Warning=dt;const jo=A({name:"FormItem",components:re,props:{formOptions:{type:Object,default:()=>{}},item:{type:Object,default:()=>{}},modelValue:{type:[String,Number,Object,Array,Boolean],default:void 0},showLabel:{type:Boolean,default:!0},components:{type:Object,default:()=>{}},mod:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:t}){const l=_(e.modelValue),a=ne(),o=_(e.item);if(o.value.type==="template"){o.value.type="v-tpl"+o.value.field;const s={};Object.keys(o.value.comp.methods||[]).forEach(n=>{s[n]=Function(`return ${o.value.comp.methods[n]}`)()}),a!==null&&(a.type.components["VTpl"+o.value.field]=C.merge({},o.value.comp,{data(){return{...o.value.comp.data}},methods:s}))}return{localValue:l,getComponentName:Ie,onFiledChange:(s,n)=>{t("update:modelValue",s,n)},compProps:(s,n)=>{const r=Fe(s,n);return e.mod==="create"&&s.value===void 0&&(r.disabled=!1),r}}}}),Eo=e=>(De("data-v-22b19f5f"),e=e(),je(),e),To=["innerHTML"],Po=Eo(()=>x("i",{class:"el-icon-warning-outline"},null,-1)),Io={style:{display:"flex","flex-direction":"column",width:"100%"}},Fo={key:0,class:"form-item-info"},Lo=["innerHTML"];function Mo(e,t,l,a,o,s){const n=se,r=B("Warning"),i=Q,d=_e;return G((u(),c(d,{prop:e.item.field},me({default:p(()=>{var m;return[x("div",Io,[x("div",{class:H({"my-inline-form-item":(m=e.formOptions)==null?void 0:m.inline})},[(u(),c(K(e.getComponentName(e.item.type)),L({key:e.item.id||"",ref:"ctrl",modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=f=>e.localValue=f)},e.compProps(e.item,e.$props.formOptions),{"onUpdate:modelValue":e.onFiledChange}),null,16,["modelValue","onUpdate:modelValue"]))],2),e.item.info&&!e.formOptions.inline?(u(),g("div",Fo,[y(i,{color:"#E6A23C"},{default:p(()=>[y(r)]),_:1}),$(),x("span",{innerHTML:e.item.info},null,8,Lo)])):V("",!0)])]}),_:2},[e.showLabel?{name:"label",fn:p(()=>[$(O(e.item.label||e.item.field)+" ",1),e.item.info&&e.formOptions.inline?(u(),c(n,{key:0,placement:"top"},{content:p(()=>[x("span",{innerHTML:e.item.info},null,8,To)]),default:p(()=>[Po]),_:1})):V("",!0)]),key:"0"}:void 0]),1032,["prop"])),[[bt,e.item.type!=="hidden"]])}const Ot=D(jo,[["render",Mo],["__scopeId","data-v-22b19f5f"]]),At=Object.freeze(Object.defineProperty({__proto__:null,default:Ot},Symbol.toStringTag,{value:"Module"})),ue={required:{required:!0,message:"该项为必填项",trigger:"blur"},string:{type:"string",message:"该项类型必须是字符串",trigger:"blur"},number:{type:"number",message:"该项类型必须是数字",trigger:"blur"},boolean:{type:"boolean",message:"该项类型必须是布尔",trigger:"blur"},integer:{type:"integer",message:"该项类型必须是整数",trigger:"blur"},float:{type:"float",message:"该项类型必须是浮点数",trigger:"blur"},array:{type:"array",message:"该项类型必须是数组",trigger:"blur"},enum:e=>({type:"enum",enum:e.split(","),message:"该项值必须在"+e+"中",trigger:"change"}),url:{type:"url",message:"请输入正确的url",trigger:"change"},email:{type:"email",message:"请输入正确的邮箱",trigger:"change"},regex:e=>({pattern:new RegExp(e),message:"该项格式必须符合"+e,trigger:"change"}),len:e=>({len:parseInt(e),message:`该项长度必须为${e}位`,trigger:"blur"}),min:e=>({min:parseInt(e),message:`该项长度至少为${e}位`,trigger:"blur"}),max:e=>({max:parseInt(e),message:`该项长度最多为${e}位`,trigger:"blur"}),required_if:(e,t,l)=>({validator:function(a,o,s){t[e]!==void 0&&String(o).length===0?s("该项为必填项"):s()},trigger:"blur"})};function No(e,t,l){if(T(e))return e;if(J(e))return[e];if(q(e)){let a=[];typeof e=="string"&&(a=e.split("|"));const o=[];return a.forEach(s=>{if(s.indexOf(":")>-1){const n=s.split(":"),r=n[0],i=n[1];ue[r]!==void 0?o.push(ue[r](i,t,l)):console.warn("not support rule: "+r)}else ue[s]!==void 0?o.push(ue[s]):console.warn("not support rule: "+s)}),o}return[]}const Ro=A({name:"VForm",components:{FormAction:Do,FormItem:Ot,ElCard:at},provide(){return{formData:this.formData,dev:this.dev,mod:this.mod}},inheritAttrs:!1,props:{prefixPath:{type:String,default:""},isSub:{type:Boolean,default:!1},modelValue:{type:Object,default:e=>{}},formItems:{type:[Array,Function],default:()=>[]},infoApi:{type:String,default:""},getApi:{type:String,default:""},saveApi:{type:[String,Boolean],default:""},options:{type:Object,default:()=>({})},afterSubmit:{type:[String,Function],default:""},afterReset:{type:[String,Function],default:""},components:{type:Object,default:()=>({})},rootData:{type:Function,default:()=>({})},dev:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},enableCache:{type:Boolean,default:!1},initQueryParams:{type:Boolean,default:!0},mod:{type:String,default:""},submitPreCheck:{type:Function,default:()=>""},submitConfirm:{type:[Boolean,Object],default:!1}},emits:["submit","reset","fieldchange","update:modelValue","mounted","devAction"],data(){return{key:0,loading:!1,submiting:!1,errMsg:"",props:C.cloneDeep(this.$props),formData:Object.assign({},this.$props.modelValue),cacheFormData:Object.assign({},this.$props.modelValue),tmpFormData:Object.assign({},this.$props.modelValue),fieldMap:{},computeRules:[],formItemsSource:[],cacheItems:[],formOptions:{},dependMap:{fieldDependFields:{},dependFieldSourceFields:{}}}},computed:{formRules(){const e={};let t=this.$props.formItems;return N(this.$props.formItems)&&(t=this.$props.formItems(this.formData)),t.forEach(l=>{l.rules!==void 0&&this.canShow(l)&&(e[l.field]=No(l.rules,this.formData,()=>this.$refs.formData))}),e},formItemsSection(){const e=[],t=this.formItemsSource.map(function(a,o){return a.index===void 0&&(a.index=`[${o}]`),a.type==="sub-form"&&a.props&&a.props["form-items"]&&(a.props["form-items"]=a.props["form-items"].map((s,n)=>(s.index===void 0&&(s.index=`[${o}].props.form-items[${n}]`),s))),a});t.forEach((a,o)=>{(o===0||a.section!==void 0)&&e.push(o)});const l=[];for(let a=0,o=1;e[a]!==void 0;a++,o++)l.push(t.slice(e[a],e[o]||t.length));return l.map(a=>{const o=this.layoutItem(a);return{name:o[0].items[0].section,children:o}})}},watch:{props:{handler(){const{formItems:e,options:t}=this.props,l=this.init(C.cloneDeep(N(e)?e(this.$props.modelValue):e));Object.keys(l).forEach(a=>{a==="formData"?(this[a]=C.merge(this.formData,l[a]),this.cacheFormData=C.cloneDeep(this.formData)):this[a]=l[a]}),this.formOptions=Oo(t||this.$props.options),setTimeout(this.computedInit,50)},immediate:!0}},mounted(){this.$watch(()=>this.rootData(),()=>{this.formItemsSource.forEach(e=>{var t,l;if(((l=(t=e.depend)==null?void 0:t.field)==null?void 0:l.indexOf("."))!==0)return;const a=this.canShow(e);e.show!==a&&(e.show=this.canShow(e),e.id=be())})},{deep:!0,immediate:!0}),this.$props.infoApi?(this.loading=!0,this.$http.request({method:"GET",url:this.$props.infoApi}).then(({data:e})=>{this.$props.infoApi!==""&&delete e.infoApi,this.$props.saveApi!==""&&delete e.saveApi,this.props=C.merge({},this.$props,e),this.loading=!1,this.key++,this.$emit("mounted",this.$refs.formData)})):this.$emit("mounted",this.$refs.formData),!this.$props.dev&&this.$props.getApi&&this.$http.request({method:"GET",url:this.$props.getApi}).then(({data:e})=>{const t=qt(e,this.formData);this.formData=Object.assign(this.formData,e),t.forEach(l=>{this.canShowPop(l,this.dependMap.dependFieldSourceFields[l]||[])}),this.key++})},methods:{async onenter(){var e;(e=this.$props.options)!=null&&e.inline&&await this.submitForm()},layoutItem(e){const t=[],l={isCard:!1,isRow:!0,items:[]};return e.forEach((a,o)=>{if(a.col=a.col||{span:24},a.col.span===24)t.push(Object.assign({},l,{items:[a]}));else if(t.length>0){const s=C.sum(t[t.length-1].items.map(n=>n.col.span));s<24&&s+a.col.span<=24?t[t.length-1].items.push(a):t.push(Object.assign({},l,{items:[a]}))}else t.push(Object.assign({},l,{items:[a]}))}),t},defaultValue(e){const t={};return e.forEach(l=>{var a,o;if(l.value!==void 0&&(t[l.field]=l.value),l.type==="sub-form"){const s=this.defaultValue(((a=l==null?void 0:l.props)==null?void 0:a.formItems)||[]);t[l.field]=((o=l==null?void 0:l.props)==null?void 0:o.repeat)===!0?[s]:s}}),t},getQueryParams(){return et(location.href)},getQueryObject(e){const t=this.initQueryParams?this.getQueryParams():{};Object.keys(t).forEach(a=>{a.indexOf("[]")>-1&&(t[a.replace("[]","")]=t[a],delete t[a])});const l={};return e.forEach(a=>{t[a.field]!==void 0&&(l[a.field]=this.parseType(a,t[a.field]))}),l},getFormData(e){const t={query:this.getQueryObject(e),default:this.defaultValue(e),model:this.$props.modelValue},l=["model","query","default"],a=[];return l.reverse().forEach(o=>{a.push(t[o])}),C.merge(a[0],a[1],a[2])},init(e){const t=this.getFormData(e),l={},a={};e.forEach(s=>{t[s.field]===void 0&&(t[s.field]=_t(s)),l[s.field]=s,s.computed!==void 0&&(a[s.field]=s.computed),s.props=this.getComponentProps(s),this.formOptions.column!==void 0&&(s.col={span:24/this.formOptions.column}),this.$props.disabled&&(s.props.disabled=!0),s.depend&&(T(s.depend)?s.depend:[s.depend]).forEach(n=>{this.dependMap.fieldDependFields[s.field]=this.dependMap.fieldDependFields[s.field]||[],this.dependMap.fieldDependFields[s.field].push(n.field),this.dependMap.dependFieldSourceFields[n.field]=this.dependMap.dependFieldSourceFields[n.field]||[],this.dependMap.dependFieldSourceFields[n.field].push(s.field)})});const o=null;return this.formData=t,e.forEach(s=>{s.show=this.canShow(s)}),{initData:C.cloneDeep(C.merge(t,o)),fieldMap:l,computeRules:a,formItemsSource:e,cacheItems:C.cloneDeep(e)}},parseType(e,t){var l;const a=t||e.value,o=He(a);let s=e.valueType;switch(e.options&&e.options[e.options.length-1]!==void 0&&(s=He((l=e.options[e.options.length-1])==null?void 0:l.value)),e.type==="switch"&&(s="boolean"),s){case"number":return o==="array"?t.map(n=>(n+"").indexOf(".")>-1?parseFloat(n):parseInt(n)):(a+"").indexOf(".")>-1?parseFloat(a):parseInt(a);case"string":return a+"";case"boolean":return Kt(a);default:return a}},async validate(){var e,t,l;try{const a=this.$props.submitPreCheck(this.formData);if(a)return this.errMsg=a,!1;if(!await this.$refs.formData.validate())return!1;for(let o=0;o<this.formItemsSource.length;o++){const s=this.formItemsSource[o],n=this.$refs[s.field]?(l=(t=(e=this.$refs[s.field][0])==null?void 0:e.$refs)==null?void 0:t.ctrl)==null?void 0:l.validate:void 0;if(!(!s.show||!n)&&(Yt(n)&&!await n()||N(n)&&!n()))return!1}return!0}catch(a){return console.error(a),!1}},async submitForm(e){if(!await this.validate())return ve("is-error"),console.warn("form validate result : false"),!1;if(!this.$props.saveApi){this.$emit("submit",this.formData);return}this.submiting=!0;const t={...this.formData};try{const l=await this.$http.request({method:"POST",url:this.$props.saveApi,data:t});console.log("response",l);let a=l.message;a==="0"&&(a=void 0),this.$message({type:"success",message:a||"保存成功"}),this.submiting=!1,setTimeout(o=>this.execAfter("afterSubmit"),1e3),console.log(111,l,a),this.$emit("submit",this.formData,l)}catch(l){console.log("submit err",l),this.submiting=!1}},resetForm(e){this.formData=C.cloneDeep(this.initData),this.$emit("update:modelValue",C.cloneDeep(this.initData)),this.$emit("reset"),setTimeout(t=>this.execAfter("afterReset"),1e3)},getComponentName(e){return ae[e]||e},getComponentProps(e){const t=e.props||{};return e.options&&(t.options=e.options),t},canShow(e){let t=!0;const l=e.depend;return l&&(T(l)?l:[l]).forEach(a=>{let o=this.formData;a.field.indexOf(".")!==-1&&(o=this.rootData());const s=a.field.replace(/^\.+/,""),n=Wt(s,o);let r=(i,d)=>i===d;T(a.value)&&(T(n)?r=(i,d)=>i.filter(function(m){return d.indexOf(m)>-1}).length>0:r=(i,d)=>i.indexOf(d)>-1),r(a.value,n)||(t=!1)}),e.hide,t},canShowPop(e,t){t.forEach(l=>{const a=this.formItemsSource.findIndex(s=>s.field===l),o=this.canShow(this.formItemsSource[a]);this.formItemsSource[a].show=o,this.formItemsSource[a].id=be(),o||(this.formData[l]=this.initData[l],(this.dependMap.dependFieldSourceFields[l]||[]).forEach(s=>{this.canShowPop(s,this.dependMap.dependFieldSourceFields[l]||[])}))})},onFiledChange(e,t,l){if(this.formData[e]=t,l){let s=!1;Object.keys(l).forEach(n=>{n!==e&&this.formData[n]!==l[n]&&(this.formData[n]=l[n],s=!0)}),s&&this.key++}this.canShowPop(e,this.dependMap.dependFieldSourceFields[e]||[]);var a;clearTimeout(a),a=setTimeout(()=>{this.computedWhen(e,t)},300),this.$emit("fieldchange",{field:e,value:t});const o=Il(this.formData);delete o.__test__,this.$emit("update:modelValue",o)},computedInit(){Object.keys(this.formData).forEach(e=>{this.computedWhen(e,this.formData[e])})},execComputeRule(e,t,l,a,o=!1){let s=[];T(l)?T(l[0])||(s=[e,...l]):s=[e,"=",l];const n={};n[e]=t,Object.keys(a||[]).forEach(r=>{const i=C.findIndex(this.formItemsSource,{field:r});if(console.log(n,s),ee(n,s))this.formItemsSource[i]=C.merge(this.formItemsSource[i],a[r],{id:be()}),a[r].value!==void 0&&(this.formData[r]=a[r].value,this.key++);else if(!o){const d=C.findIndex(this.cacheItems,{field:r});this.formItemsSource[i]=C.cloneDeep(this.cacheItems[d],{id:(this.formItemsSource[i]||0)+1});const m=this.cacheFormData[r]||this.cacheItems[d].value;a[r].value!==void 0&&m&&(this.formData[r]=m,this.key++)}})},computedWhen(e,t){const l=this.computeRules[e];if(l!==void 0){if(T(l)){l.forEach(a=>{this.execComputeRule(e,t,a.when,a.set||[],!0)});return}this.execComputeRule(e,t,l.when,l.set||[])}},execAfter(e){const t=this.props[e];if(t!==void 0){if(q(t))switch(this.props[e]){case"goback":this.$route&&this.$route.preHash?this.$router.push(this.$route.preHash):history.state.back&&history.back();break;case"reload":location.reload();break}N(t)&&t()}},onDevAction(e,t){this.$emit("devAction",e,t)}}});function Ho(e,t,l,a,o,s){const n=pl,r=B("form-item"),i=B("form-action"),d=Y,m=W,f=xe,v=nt;return u(),g(j,null,[e.errMsg?(u(),c(n,{key:0,type:"error",style:{margin:"20px 40px"}},{default:p(()=>[$(O(e.errMsg),1)]),_:1})):V("",!0),e.formItemsSection.length>0?G((u(),c(f,{ref:"formData",key:e.key,class:"v-form",model:e.formData,rules:e.formRules,"label-width":e.formOptions.labelWidth,inline:e.formOptions.inline,"label-position":e.formOptions.labelPosition,"validate-on-rule-change":!1,onKeyup:Ll(e.onenter,["enter"])},{default:p(()=>[y(m,null,{default:p(()=>[(u(!0),g(j,null,F(e.formItemsSection,(b,h)=>(u(),c(K(e.formOptions.inline||h===0&&e.formItemsSection.length===1?"span":"el-card"),{key:"item-"+h,class:H(e.formOptions.inline?"form-section-inline":"form-section"),shadow:"never"},me({default:p(()=>[(u(!0),g(j,null,F(b.children,(w,S)=>(u(),c(K(e.formOptions.inline?"span":w.isRow?"el-row":"span"),{key:"section-"+h+"-"+S},{default:p(()=>[(u(!0),g(j,null,F(w.items,(k,E)=>(u(),c(K(e.formOptions.inline?"span":"el-col"),{key:"each-"+E,span:k.col.span},{default:p(()=>[G((u(),c(r,{key:k.id,ref_for:!0,ref:k.field,modelValue:e.formData[k.field],"onUpdate:modelValue":[M=>e.formData[k.field]=M,(M,R)=>e.onFiledChange(k.field,M,R)],devtool:"{devId: `${prefixPath}${each.index}`, dev: dev}","form-options":e.formOptions,components:e.components,item:k,"show-label":!!e.formOptions.labelWidth,mod:e.props.mod},null,8,["modelValue","onUpdate:modelValue","form-options","components","item","show-label","mod"])),[[bt,k.type!=="hidden"&&k.show]])]),_:2},1032,["span"]))),128))]),_:2},1024))),128))]),_:2},[b.name?{name:"header",fn:p(()=>[x("span",null,O(b.name),1)]),key:"0"}:void 0]),1032,["class"]))),128)),e.formOptions.inline===!0?(u(),c(i,{key:0,submiting:e.submiting,"form-options":e.formOptions,"submit-confirm":e.submitConfirm,onSubmit:t[0]||(t[0]=b=>e.submitForm("formData")),onCancel:t[1]||(t[1]=b=>e.resetForm("formData"))},null,8,["submiting","form-options","submit-confirm"])):(u(),c(d,{key:1,span:24},{default:p(()=>[y(i,{submiting:e.submiting,"form-options":e.formOptions,"submit-confirm":e.submitConfirm,onSubmit:t[2]||(t[2]=b=>e.submitForm("formData")),onCancel:t[3]||(t[3]=b=>e.resetForm("formData"))},null,8,["submiting","form-options","submit-confirm"])]),_:1}))]),_:1})]),_:1},8,["model","rules","label-width","inline","label-position","onKeyup"])),[[v,e.loading]]):V("",!0)],64)}const Le=D(Ro,[["render",Ho],["__scopeId","data-v-b1fa80bf"]]),Bt=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"})),Uo=Object.freeze(Object.defineProperty({__proto__:null,MonacoEditor:Pe,VCascaderPanel:Ct,VForm:Le,VInput:wt,VJson:gt,VRule:St,VSelect:yt,VUpload:vt,customFormComps:re,getComponentName:Ie,regCustomFormComps:Ao,setUploadHeaderHandle:Bo},Symbol.toStringTag,{value:"Module"})),Dt=["click","afterClick","apiError","apiSuccess","action","formReset","formSubmit"],jt={props:{type:Object,default:()=>{}},metaData:{type:[Object,Function],default:()=>{}},injectData:{type:[Object,Function],default:()=>{}},dynamicExtra:{type:Function,default:e=>e},preCheck:{type:Function,default:()=>!0},container:{type:String,default:"dialog",validator:e=>["dialog","drawer"].indexOf(e)!==-1},containerProps:{type:Object,default:()=>{}},beforeCloseContainer:{type:Function,default:()=>()=>!0},confirm:{type:Boolean,default:!0}},Me={VForm:Z(()=>Promise.resolve().then(()=>Bt)),VTable:Z(()=>Promise.resolve().then(()=>Mt)),VPlayer:Z(()=>Promise.resolve().then(()=>en))},zo={onclick(e,t,l,a,o){a!=null&&a.actionHandler&&N(a==null?void 0:a.actionHandler)?a==null||a.actionHandler():setTimeout(()=>l.emit("action"),200),o()}},qo={onclick(e,t){const l=e();if(/http.*/.test(l))window.open(l);else{if(!t.$router){console.error("you must set : app.config.globalProperties.$router = createRouter()");return}t.$router.push(l).then()}}},Ko={onclick(e,t,l,a,o){if(!t.$http){console.error("you must set : app.config.globalProperties.$http = axios.create()");return}const s={url:e,...a};if(a.sourceData!==void 0&&J(a.sourceData)){const n={};Object.keys(a.sourceData).forEach(r=>{const i=C.get(a.metaData||{},a.sourceData[r]);n[r]=i}),s.data={...s.data||{},...n}}t.$http.request(s).then(n=>{var r;l.emit("apiSuccess",n),o(),Se({message:((r=n==null?void 0:n.data)==null?void 0:r.message)||"操作成功",type:"success",duration:5*1e3})}).catch(n=>{l.emit("apiError",n)})},getSubProps(e,t){return e.infoApi&&(e.infoApi=P(e.infoApi,t)),e}},Yo={onclick(e,t,l,a,o){o()},getSubComp(){return"VForm"},getSubProps(e,t){Object.keys(e).forEach(s=>{/.*Api$/.test(s)&&(e[s]=P(e[s],{...t,...t.$row}))});const l={},a=N(e.formItems)?e.formItems(t):e.formItems||[],o=t||{};return a.forEach(s=>{o&&o[s.field]!==void 0&&(l[s.field]=o[s.field])}),console.log(111,{modelValue:l,...e}),{modelValue:l,...e}},getSubEvent(e,t,l,a){return{submit(o,s){console.log(o,s),!(s&&s.code!==0)&&(console.log(222),l.value=!1,a!=null&&a.actionHandler&&N(a==null?void 0:a.actionHandler)?a==null||a.actionHandler(o):setTimeout(()=>t.emit("action"),200))},reset(){l.value=!1}}}},Wo={onclick(e,t,l,a,o){o()},getSubComp(e){const t=e.type;return t?"v-"+t:""},getSubProps(e,t){const l={};return Object.keys(e).forEach(a=>{/.*Api$/.test(a)?l[a]=P(e[a],t):e[a]!=="type"&&(l[a]=e[a])}),console.log(l,t),l},getSubEvent(e,t,l){return{}}},Go={onclick(e,t,l,a,o){o()},getSubComp(){return"VTable"},getSubProps(e,t){return Object.keys(e).forEach(l=>{/.*Api$/.test(l)&&(e[l]=P(e[l],t))}),e},getSubEvent(e,t,l){return{reset(){var a;l.value=!1,"reset"in e.extra&&e.extra.reset&&((a=e.extra)==null||a.reset())},submit(a){var o;"submit"in e.extra&&e.extra.submit&&((o=e.extra)==null||o.submit(a))}}}},de={jump:qo,api:Ko,form:Yo,table:Go,modal:Wo,base:zo};function Et(e,t){let l={"append-to-body":!0,"destroy-on-close":!0};return e==="dialog"&&(l={width:"80%",...l}),e==="drawer"&&(l={size:"80%",...l}),{...l,...t.containerProps}}function Jo(e){Object.keys(e).forEach(t=>{Me[t]=e[t]})}const Qo=A({name:"VButton",components:{...Me,ElDialog:oe,ElDrawer:ot},props:{type:{type:String,default:"",validator:e=>["jump","api","form","table","modal","","base"].includes(e)},target:{type:String,default:""},text:{type:String,default:void 0},extra:{type:Object,default(){return{}}},...jt},emits:Dt,setup(e,t){const l=ne().appContext.config.globalProperties,a=_(!1),o=de[e.type||"base"];if(console.log(e.type,de),!o)return console.error(`您所配置的 button.type=${e.type} 不存在, 仅支持`+Object.keys(de).join(", ")),{};const s=()=>N(e.metaData)?e.metaData():e.metaData,n=()=>N(e.injectData)?e.injectData(e.extra):e.injectData,r=b=>{if(t.emit("click",b),!e.preCheck(e))return;const h=()=>P(e.target||"",s());let w=e.extra||{};w.url===void 0&&(w.url=e.target),w=e.dynamicExtra({...w});const S=n();w.method===void 0||w.method==="GET"?w.params=C.merge(w.params,S):w.data=C.merge(w.data,S);const k={...w,metaData:s()};Object.keys(k).forEach(E=>{q(k[E])&&(k[E]=P(k[E],s()))}),o.onclick(h,l,t,k,()=>{["modal","form","table"].indexOf(e.type)>-1&&(a.value=!0),["api"].indexOf(e.type)>-1&&t.emit("action")})},i=U(()=>P(e.text||"",s())),d=_({}),m=_("span"),f=_({}),v=_({});return Be(()=>a.value,()=>{d.value=Et(e.container,e),m.value=o.getSubComp?o.getSubComp(e.extra||{}):"span",console.log(222,o,m.value),f.value=o.getSubProps?o.getSubProps(e.extra,s()):{},v.value=o.getSubEvent?o.getSubEvent(e,t,a,e.extra):{}}),{clickHandler:r,relText:i,showContainer:a,containerProps:d,beforeClose:()=>{e.beforeCloseContainer()&&(a.value=!1)},xsubComp:m,xsubProps:f,xsubEvent:v,closeModal:()=>{a.value=!1},transBtnProps:b=>{if(b&&b.icon&&q(b.icon)){const h=Xe(b.icon.replace("el-icon-",""),"-");b.icon=Fl(ct[h])}return b}}}}),Xo={class:"v-btn"};function Zo(e,t,l,a,o,s){const n=z,r=cl;return u(),g("span",Xo,[e.$props.type==="api"&&e.confirm?(u(),c(r,{key:0,title:"确定要"+(e.relText?e.relText:"操作")+"吗",onConfirm:e.clickHandler},{reference:p(()=>[e.relText?(u(),c(n,ce(L({key:0},e.transBtnProps(e.$props.props))),{default:p(()=>[$(O(e.relText),1)]),_:1},16)):(u(),c(n,ce(L({key:1},e.transBtnProps(e.$props.props))),null,16))]),_:1},8,["title","onConfirm"])):(u(),g(j,{key:1},[e.relText?(u(),c(n,L({key:0},e.transBtnProps(e.$props.props),{onClick:e.clickHandler}),{default:p(()=>[$(O(e.relText),1)]),_:1},16,["onClick"])):(u(),c(n,L({key:1},e.transBtnProps(e.$props.props),{onClick:e.clickHandler}),null,16,["onClick"]))],64)),e.showContainer?(u(),c(K("el-"+e.container),L({key:2,modelValue:e.showContainer,"onUpdate:modelValue":t[0]||(t[0]=i=>e.showContainer=i)},e.containerProps,{"before-close":e.beforeClose,title:e.relText}),{default:p(()=>[X(e.$slots,"default"),e.xsubComp!==""?(u(),c(K(e.xsubComp),L({key:0},e.xsubProps,ft(e.xsubEvent)),null,16)):V("",!0)]),_:3},16,["modelValue","before-close","title"])):V("",!0)])}const te=D(Qo,[["render",Zo]]),es={splitButton:!1},ts=A({name:"VButtonGroup",components:{...Me,ArrowDown:Sl,ElDialog:oe,ElDrawer:ot},props:{buttons:{type:Array,default:()=>[]},...jt},emits:Dt,setup(e,t){const l=ne().appContext.config.globalProperties,a={...es,...e.props},o=S=>P(S,e.metaData),s=_(void 0),n=_(!1),r=U(()=>{var S;return((S=e.buttons)==null?void 0:S.length)>0?o(e.buttons[0].text||""):""}),i=_(null),d=S=>{if(S=S-1,!e.preCheck(e))return;const k=e.buttons[S],E=()=>N(k["meta-data"])?k["meta-data"]():k["meta-data"],M=()=>P(k.target||"",E());i.value=de[k.type||"base"];let R=k.extra||{};R.url===void 0&&(R.url=k.target);const Re=N(k["inject-data"])?k["inject-data"](R):k["inject-data"];R=N(k["dynamic-extra"])?k["dynamic-extra"]({...R}):R,R.method===void 0||R.method==="GET"?R.params=C.merge(R.params,Re):R.data=C.merge(R.data,Re);const le={...R},Nt=E();Object.keys(le||{}).forEach(he=>{q(le[he])&&(le[he]=P(le[he],Nt||{}))}),i.value.onclick(M,l,t,le,()=>{s.value=S,["modal","form","table"].indexOf(k.type)>-1&&(n.value=!0),["api"].indexOf(k.type)>-1&&t.emit("action"),N(e.buttons[S].onClick)&&e.buttons[S].onClick(S)})},m=()=>{e.beforeCloseContainer()&&(n.value=!1)},f=U(()=>{const S=e.buttons[s.value];return o(S.text||"")}),v=_({}),b=_("span"),h=_({}),w=_({});return Be(()=>s.value,()=>{const S=e.buttons[s.value];v.value=Et(e.container,e);const k=N(S["meta-data"])?S["meta-data"]():S["meta-data"];b.value=i.value&&i.value.getSubComp?i.value.getSubComp(S.extra||{}):"span",h.value=i.value&&i.value.getSubProps?i.value.getSubProps(S.extra,k):{},w.value=i.value&&i.value.getSubEvent?i.value.getSubEvent(S,t,n):{}}),{dropProps:a,showText:r,replaceText:o,clickHandle:d,showContainer:n,containerProps:v,beforeClose:m,xsubComp:b,xsubProps:h,xsubEvent:w,containerTitle:f}}}),ls={class:"v-btn"};function as(e,t,l,a,o,s){const n=B("arrow-down"),r=Q,i=z,d=ml,m=hl,f=fl;return u(),g("span",ls,[y(f,L(e.dropProps,{onCommand:e.clickHandle}),{dropdown:p(()=>[y(m,null,{default:p(()=>[(u(!0),g(j,null,F(e.buttons,(v,b)=>(u(),c(d,{key:b+"button-group",command:b+1},{default:p(()=>[$(O(v.text),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:p(()=>[e.dropProps.splitButton?(u(),g(j,{key:0},[$(" 更多 ")],64)):(u(),c(i,{key:1,type:e.dropProps.type},{default:p(()=>[$(" 更多"),y(r,{class:"el-icon--right"},{default:p(()=>[y(n)]),_:1})]),_:1},8,["type"]))]),_:1},16,["onCommand"]),e.showContainer?(u(),c(K("el-"+e.container),L({key:0,modelValue:e.showContainer,"onUpdate:modelValue":t[0]||(t[0]=v=>e.showContainer=v)},e.containerProps,{"before-close":e.beforeClose,title:e.containerTitle}),{default:p(()=>[(u(),c(K(e.xsubComp),L(e.xsubProps,ft(e.xsubEvent)),null,16))]),_:1},16,["modelValue","before-close","title"])):V("",!0)])}const Tt=D(ts,[["render",as]]),os=A({components:{VButton:te,VButtonGroup:Tt},inject:{dev:{from:"dev",default:!1}},props:{buttons:{type:Array,default:()=>[]},prefixPath:{type:String,default:""}},emits:["click","action"],data(){return{localButton:[]}},watch:{buttons:{deep:!0,immediate:!0,handler(e,t){const l=[];this.$props.buttons.forEach(a=>{delete a.when,l.push(a)}),this.localButton=l}}},methods:{isArray(e){return T(e)},onclick(e){this.$emit("click",e)},onaction(e){this.$emit("action",e)}}});function ss(e,t,l,a,o,s){const n=B("v-button-group"),r=B("v-button");return u(!0),g(j,null,F(e.localButton,(i,d)=>(u(),g(j,{key:d+"v-button"},[e.isArray(i)?(u(),c(n,L({key:0,devtool:"{devId: `${prefixPath}[${index}]`, dev: dev}"},{buttons:i},{onClick:e.onclick,onAction:e.onaction}),null,16,["onClick","onAction"])):(u(),c(r,L({key:1,devtool:"{devId: `${prefixPath}[${index}]`, dev: dev}"},i,{onClick:e.onclick,onAction:e.onaction}),null,16,["onClick","onAction"]))],64))),128)}const Ne=D(os,[["render",ss]]);function ns(e,t=!0){let l="";return C.cloneDeep(e).reverse().forEach((a,o)=>{var s;o<2&&(s=a.meta)!=null&&s.title&&(l=a.meta.title+(l&&"-"+l))}),l}class is{constructor(){Je(this,"SheetNames",[]),Je(this,"Sheets",{})}}const rs=e=>(+e-+new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),us=e=>{const t={},l={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let a=0;a!==e.length;++a)for(let o=0;o!==e[a].length;++o){l.s.r>a&&(l.s.r=a),l.s.c>o&&(l.s.c=o),l.e.r<a&&(l.e.r=a),l.e.c<o&&(l.e.c=o);const s={v:e[a][o],t:"",z:""};if(s.v==null)continue;const n=ge.encode_cell({c:o,r:a});typeof s.v=="number"?s.t="n":typeof s.v=="boolean"?s.t="b":s.v instanceof Date?(s.t="n",s.z=Bl.get_table()[14],s.v=rs(s.v)):s.t="s",t[n]=s}return l.s.c<1e7&&(t["!ref"]=ge.encode_range(l)),t},ds=e=>{const t=new ArrayBuffer(e.length),l=new Uint8Array(t);for(let a=0;a!==e.length;++a)l[a]=e.charCodeAt(a)&255;return t},Pt=(e,t,l="excel-list",a=[],o=[],s=!0,n="xlsx")=>{t.unshift(e);for(let f=a.length-1;f>-1;f--)t.unshift(a[f]);const r="SheetJS",i=new is,d=us(t);if(o.length>0&&(d["!merges"]||(d["!merges"]=[]),o.forEach(f=>{d["!merges"].push(ge.decode_range(f))})),s){const f=t.map(b=>b.map(h=>h==null?{wch:10}:h.toString().charCodeAt(0)>255?{wch:h.toString().length*2}:{wch:h.toString().length})),v=f[0];for(let b=1;b<f.length;b++)for(let h=0;h<f[b].length;h++)v[h].wch<f[b][h].wch&&(v[h].wch=f[b][h].wch);d["!cols"]=v}i.SheetNames.push(r),i.Sheets[r]=d;const m=Al(i,{bookType:n,bookSST:!1,type:"binary"});Ol.saveAs(new Blob([ds(m)],{type:"application/octet-stream"}),`${l}.${n}`)},ps=A({name:"ExportAddButton",props:{getInfo:{type:Function,default:void 0}},data(){return{dialogVisible:!1,task:{page:1,size:20,total:200}}},computed:{percentage(){return(this.task.page/Math.ceil(this.task.total/this.task.size)&&1)*100}},methods:{async execute(){const e=this.$props.getInfo();this.task=Object.assign(this.task,e);let t=[];const l=[],a=[];for(e.header.forEach(o=>{l.push(o.label),a.push(o.field)}),this.dialogVisible=!0;this.task.page<=Math.ceil(this.task.total/this.task.size);){const o=Object.assign({_page:e.page||1,_size:e.size||20},e.filter||{}),{data:s}=await this.$http.request({method:"GET",url:e.listApi,params:o}),n=[];(s.list||[]).forEach(r=>{const i=[];a.forEach(d=>{i.push(r[d])}),n.push(i)}),t=s.list.concat(n),this.task.page++,this.task.total=s.page.count}Pt(l,t,e.name),this.$message.success("文件导出成功"),this.dialogVisible=!1}}});function cs(e,t,l,a,o,s){const n=z,r=yl,i=oe;return u(),g(j,null,[y(n,{type:"primary",onClick:e.execute},{default:p(()=>[$("导出")]),_:1},8,["onClick"]),y(i,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=d=>e.dialogVisible=d),title:"提示",width:"30%"},{default:p(()=>[y(r,{percentage:e.percentage},null,8,["percentage"])]),_:1},8,["modelValue"])],64)}const ms=D(ps,[["render",cs]]),hs=A({__name:"emum",props:{data:{type:[String,Number,Array],default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}},when:{type:Array,default:()=>[]}},setup(e){const t=e,{column:l,data:a}=Pl(t),o=U(()=>T(a==null?void 0:a.value)?a==null?void 0:a.value:[a==null?void 0:a.value]),s=i=>{var d,m;const f=["success","info","warning","danger"],v=(d=l.value)!=null&&d.state?(m=l.value)==null?void 0:m.state:f,b=v[i]?v[i]:i;return f.indexOf(b)>-1?b+"":""},n=i=>{var d;if(i==="")return"";const m=C.findIndex((d=l.value)==null?void 0:d.options,{value:i}),f=l.value.options?l.value.options[m]:!1;return f?f.label:i},r=U(()=>{const i=t.when;return i.length===0?!0:ee({data:a==null?void 0:a.value},["data",...i])});return(i,d)=>{const m=we;return I(r)?(u(!0),g(j,{key:0},F(I(o).filter(f=>n(f)!==""),(f,v)=>(u(),c(m,{key:v,type:s(f)},{default:p(()=>[$(O(n(f)),1)]),_:2},1032,["type"]))),128)):V("",!0)}}}),fs={name:"CellSpan",props:{data:{type:String,default:""},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}}},bs=["innerHTML"];function ys(e,t,l,a,o,s){return u(),g("span",{innerHTML:l.data},null,8,bs)}const gs=D(fs,[["render",ys]]),vs={name:"CellImage",props:{data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}}},ws={class:"image-item"};function Vs(e,t,l,a,o,s){const n=st;return u(),g("div",ws,[l.data?(u(),c(n,{key:0,lazy:!0,class:"cell-image",src:l.data,"preview-src-list":[l.data]},null,8,["src","preview-src-list"])):V("",!0)])}const ks=D(vs,[["render",Vs],["__scopeId","data-v-d715bbc6"]]),Cs=A({__name:"link",props:{data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}},setup(e){const t=e,l=U(()=>C.merge({type:"primary",href:t.data,target:"_blank"},t.column.props||{}));return(a,o)=>{const s=al;return u(),c(s,ce(jl(I(l))),{default:p(()=>[$(O(e.column.label),1)]),_:1},16)}}}),Ss={name:"JsonView",props:{data:{type:[Object,Array],required:!0},jsonKey:{type:String,default:""},closed:{type:Boolean,default:!1},isLast:{type:Boolean,default:!0},fontSize:{type:Number,default:14},lineHeight:{type:Number,default:24},deep:{type:Number,default:3},currentDeep:{type:Number,default:1},iconStyle:{type:String,default:"circle"},iconColor:{type:Array,default(){return[]}},theme:{type:String,default:""},hasSiblings:{type:Boolean,default:!0},tools:{type:Boolean,default:!0}},data(){return{innerclosed:this.closed,templateDeep:this.currentDeep,visible:!1}},computed:{isArray(){return this.getDataType(this.data)==="array"},length(){return this.isArray?this.data.length:Object.keys(this.data).length},subfix(){const e=this.data;return this.isEmptyArrayOrObject(e)?"":(this.isArray?"]":"}")+(this.isLast?"":",")},prefix(){return this.isArray?"[":"{"},items(){const e=this.data;return this.isArray?e.map(t=>{const l=this.isObjectOrArray(t);return{value:t,isJSON:l,key:""}}):Object.keys(e).map(t=>{const l=e[t],a=this.isObjectOrArray(l);return{value:l,isJSON:a,key:t}})},iconColors(){const{theme:e,iconColor:t}=this;return t.length===2?t:e==="one-dark"?["#747983","#747983"]:e==="vs-code"?["#c6c6c6","#c6c6c6"]:["#747983","#747983"]}},watch:{closed(){this.innerclosed=this.closed}},mounted(){setTimeout(()=>{this.visible=!0},0)},methods:{getDataType(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},isObjectOrArray(e){return["array","object"].includes(this.getDataType(e))},toggleClose(){this.length!==0&&(this.innerclosed=!this.innerclosed)},isClose(){return this.templateDeep+1>this.deep},isEmptyArrayOrObject(e){return[{},[]].map(t=>JSON.stringify(t)).includes(JSON.stringify(e))},copy(){Ze(JSON.stringify(this.data,null,2))}}},xs={key:0,class:"json-view-tool"},_s={class:"content-wrap"},$s={key:0,class:"json-key"},Os={key:1},As={class:"json-note"},Bs={key:2},Ds={key:0,class:"json-body"},js={key:1,class:"json-item"},Es={class:"json-key"},Ts={key:0,class:"base-line"},Ps={key:1,class:"last-line"};function Is(e,t,l,a,o,s){const n=se,r=B("json-view");return u(),g(j,null,[l.tools?(u(),g("div",xs,[y(n,{content:"复制"},{default:p(()=>[x("i",{class:"el-icon-copy-document",onClick:t[0]||(t[0]=(...i)=>s.copy&&s.copy(...i))})]),_:1})])):V("",!0),o.visible?(u(),g("div",{key:1,class:H(["json-view-container",l.theme,`deep-${l.currentDeep}`])},[x("div",{class:H(["json-view",s.length?"closeable":""]),style:Ee({fontSize:l.fontSize+"px",lineHeight:l.lineHeight+"px"})},[s.length&&l.iconStyle==="square"?(u(),g("span",{key:0,class:"angle",onClick:t[1]||(t[1]=(...i)=>s.toggleClose&&s.toggleClose(...i))},[x("i",{class:H("el-icon-"+(o.innerclosed?"plus":"minus"))},null,2)])):V("",!0),s.length&&l.iconStyle==="circle"?(u(),g("span",{key:1,class:"angle",onClick:t[2]||(t[2]=(...i)=>s.toggleClose&&s.toggleClose(...i))},[x("i",{class:H("el-icon-"+(o.innerclosed?"circle-plus-outline":"remove-outline"))},null,2)])):V("",!0),s.length&&l.iconStyle==="triangle"?(u(),g("span",{key:2,class:"angle",onClick:t[3]||(t[3]=(...i)=>s.toggleClose&&s.toggleClose(...i))},[x("i",{class:H("el-icon-"+(o.innerclosed?"caret-right":"el-icon-caret-bottom"))},null,2)])):V("",!0),x("div",_s,[x("p",{class:H(["first-line",s.length>0?"pointer":""]),onClick:t[4]||(t[4]=(...i)=>s.toggleClose&&s.toggleClose(...i))},[l.jsonKey?(u(),g("span",$s,'"'+O(l.jsonKey)+'": ',1)):V("",!0),s.length?(u(),g("span",Os,[$(O(s.prefix)+O(o.innerclosed?"..."+s.subfix:"")+" ",1),x("span",As,O(o.innerclosed?s.length+" items":""),1)])):V("",!0),$(),s.length?V("",!0):(u(),g("span",Bs,O(`${s.isArray?"[]":"{}"}${l.isLast?"":","}`),1))],2),!o.innerclosed&&s.length?(u(),g("div",Ds,[(u(!0),g(j,null,F(s.items,(i,d)=>(u(),g(j,{key:d},[i.isJSON?(u(),c(r,{key:0,closed:s.isClose(),data:i.value,"json-key":i.key,"current-deep":o.templateDeep+1,deep:l.deep,"icon-style":l.iconStyle,theme:l.theme,"font-size":l.fontSize,"line-height":l.lineHeight,"icon-color":s.iconColors,"is-last":d===s.items.length-1,"has-siblings":i.hasSiblings,tools:!1},null,8,["closed","data","json-key","current-deep","deep","icon-style","theme","font-size","line-height","icon-color","is-last","has-siblings"])):(u(),g("p",js,[x("span",Es,O(s.isArray?"":'"'+i.key+'":'),1),x("span",{class:H(["json-value",s.getDataType(i.value)])},O(`${s.getDataType(i.value)==="string"?'"':""}${i.value}${s.getDataType(i.value)==="string"?'"':""}${d===s.items.length-1?"":","}`),3)]))],64))),128)),o.innerclosed?V("",!0):(u(),g("span",Ts))])):V("",!0),o.innerclosed?V("",!0):(u(),g("p",Ps,[x("span",null,O(s.subfix),1)]))])],6)],2)):V("",!0)],64)}const It=D(Ss,[["render",Is],["__scopeId","data-v-f41f94ce"]]),Fs=A({__name:"json",props:{data:{type:[Object,String,Array],default:()=>{}},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}},setup(e){const t=e,l=U(()=>q(t.data)?JSON.parse(t.data):t.data);return(a,o)=>(u(),c(te,{type:"modal",text:"查看"},{default:p(()=>[y(It,{data:I(l)},null,8,["data"])]),_:1}))}}),Ls=A({__name:"span",props:{data:{type:[String,Number,Array,Object],default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},render:{type:String,default:""},scope:{type:Object,default:()=>{}}},setup(e){const t=e,l=U(()=>t.render?new Function("return "+t.render)()(t.data,t.row):t.data);return(a,o)=>(u(),g("span",null,O(I(l)),1))}}),Ms={name:"CellRichText",functional:!0,props:{data:{type:[String,Number,Array],default:""},row:{type:Object,default:()=>{}}},setup(e){let t=e.data;const l=function(o){const s=/<([\s\S]*?)>/g;let n=s.exec(o);const r=[];for(;n!=null;)r.push(RegExp.$1),n=s.exec(o);return r};(typeof t=="string"||typeof t=="number")&&(t=[t]);const a=[];for(let o=0;o<t.length;o++){const s=l(t[o]),n={};let r=t[o];for(let i=0;i<s.length;i++){const d=r.split("<"+s[i]+">");a.push(y("span",null,[d[0]]));const m=s[i].split("|");let f={color:void 0,background:void 0};m[1]!==void 0&&(f.color=m[1]),m[2]!==void 0&&(f.background=m[2]),f=Object.assign({},n,f),a.push(y("span",{class:"el-tag el-tag--mini",style:f},[m[0]])),r=d[1]}a.push(y("span",null,[r])),o<t.length-1&&a.push(y("br",null,null))}return()=>y("div",null,[a])}},Ns=A({__name:"icon",props:{data:{},row:{},scope:{}},setup(e){return(t,l)=>{const a=B("v-icon");return u(),c(a,{name:t.data},null,8,["name"])}}}),Rs={key:0},Hs=["innerHTML"],Us=A({__name:"tpl",props:{data:{type:[String,Number,Array,Object],default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},tpl:{type:String,default:""},interval:{type:Number,default:0},api:{type:Object,default:void 0},scope:{type:Object,default:()=>{}},extraData:{type:Object,default:()=>{}}},setup(e){const t=e,{$http:l}=Te(),a=_("");let o;const s=_(!1);return Ae(()=>{if(a.value=P(t.tpl,{...t.row,...t.extraData}),t.api===void 0)return;const n={url:"",method:"GET",...t.api,data:t.row};n.url=P(n.url,{...t.row,...t.extraData});const r=()=>{s.value=!0,l==null||l.request(n).then(i=>{a.value=P(t.tpl,{...i.data,...t.extraData,resp:i.data}),s.value=!1}).catch(i=>{s.value=!1})};r(),t.interval>0&&(o=setInterval(r,t.interval))}),El(()=>{clearInterval(o)}),(n,r)=>{const i=Q;return I(s)?(u(),g("span",Rs,[y(i,{class:"is-loading"},{default:p(()=>[y(I(Vl))]),_:1})])):(u(),g("span",{key:1,innerHTML:I(a)},null,8,Hs))}}}),zs={__name:"view",props:{fields:{type:Array,default:()=>[]},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}},setup(e){const t=e,l=U(()=>{var a,o;if(((a=t.fields)==null?void 0:a.length)===0)return t.row;const s={};return(o=t.fields)==null||o.forEach(n=>{s[n]=t.row[n]}),s});return(a,o)=>(u(),c(te,{type:"modal",text:"查看"},{default:p(()=>[y(It,{data:I(l)},null,8,["data"])]),_:1}))}},qs=zs,Ks={name:"VChart",props:{options:{type:Object,default:()=>{}}},setup(e){const t=_(null),l=null;Oe(()=>{a()});const a=Zt(()=>l.value.resize(),200);return ht(()=>{window.removeEventListener("resize",a)}),{chartDom:t,chart:l}}},Ys={ref:"chartDom",class:"chart",style:{height:"100%",width:"100%"}};function Ws(e,t,l,a,o,s){return u(),g("div",Ys,null,512)}const Gs=D(Ks,[["render",Ws]]),Js=A({__name:"chart",props:{data:{type:Array,default:()=>[]},column:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}},options:{type:Object,default:()=>{}},noDataText:{type:String,default:"暂无数据"},row:{type:Object,default:()=>{}}},setup(e){const t=e,l={title:{text:""},tooltip:{trigger:"axis"},grid:{left:"2%",right:"2%",bottom:"5%",containLabel:!0},xAxis:{type:"category",data:[]},yAxis:{type:"value"}},a=U(()=>{var o;const s=C.cloneDeep(C.merge({series:[]},t.options,l));return(o=t.data)==null||o.forEach(n=>{s.xAxis.data.push(n[0]),n.forEach((r,i)=>{i>0&&(s.series[i-1].data=s.series[i-1].data||[],s.series[i-1].data.push(r))})}),s});return(o,s)=>{const n=Y,r=W;return t.data.length>0?(u(),c(te,{key:0,type:"modal",text:"查看"},{default:p(()=>[y(r,null,{default:p(()=>[y(n,null,{default:p(()=>[y(Gs,{options:I(a)},null,8,["options"])]),_:1})]),_:1})]),_:1})):V("",!0)}}}),Qs=A({name:"VPlayer",props:{playurl:{type:String,default:""},playApi:{type:String,default:""}},data(){return{loading:!1,localPlayUrl:this.$props.playurl}},beforeCreate(){this.$props.playApi&&this.$http.request({url:this.$props.playApi}).then(({data:e})=>{console.log(e),this.localPlayUrl=e.playurl})}}),Xs=["src"];function Zs(e,t,l,a,o,s){return e.localPlayUrl?(u(),g("video",{key:e.localPlayUrl,src:e.localPlayUrl,controls:"controls",preload:"",autoplay:"autoplay",style:{width:"100%",height:"500px"}},null,8,Xs)):V("",!0)}const Ft=D(Qs,[["render",Zs]]),en=Object.freeze(Object.defineProperty({__proto__:null,default:Ft},Symbol.toStringTag,{value:"Module"})),tn={name:"CellPlayer",components:{VPlayer:Ft},props:{data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},scope:{type:Object,default:()=>{}}}},ln={class:"image-item"};function an(e,t,l,a,o,s){const n=B("v-player");return u(),g("div",ln,[y(n,{playurl:l.data},null,8,["playurl"])])}const on=D(tn,[["render",an]]),sn={key:1},nn={inheritAttrs:!1},rn=A({...nn,__name:"sortIndex",props:{data:{type:String,default:""},column:{type:Object,default:()=>{}},row:{type:Object,default:()=>{}},ctrl:{type:Boolean,default:!1},scope:{type:Object,default:()=>{}}},emits:["sortIndexChange"],setup(e,{emit:t}){const l=e,a=_(l.scope.$index+1),o=_(!1),s=()=>{console.log(new Date().getTime()),t("sortIndexChange",{from:l.scope.$index,to:a.value-1}),o.value=!1};return(n,r)=>{const i=Y,d=z,m=W;return I(o)?(u(),g("span",sn,[y(m,{gutter:10},{default:p(()=>[y(i,{span:18},{default:p(()=>[y(xt,{modelValue:I(a),"onUpdate:modelValue":r[1]||(r[1]=f=>ie(a)?a.value=f:null),props:{controls:!1},style:{width:"auto"}},null,8,["modelValue"])]),_:1}),y(i,{span:6},{default:p(()=>[y(d,{icon:I(kl),type:"success",circle:"",onClick:s},null,8,["icon"])]),_:1})]),_:1})])):(u(),g("span",{key:0,style:{display:"inline-block",width:"100%"},onClick:r[0]||(r[0]=f=>o.value=!I(o))},O(I(a)),1))}}}),un=Object.freeze(Object.defineProperty({__proto__:null,CellChart:Js,CellEnum:hs,CellHtml:gs,CellIcon:Ns,CellImage:ks,CellJson:Fs,CellLink:Cs,CellPlayer:on,CellRichText:Ms,CellSortIndex:rn,CellSpan:Ls,CellTpl:Us,CellView:qs},Symbol.toStringTag,{value:"Module"})),dn=A({name:"CellEdit",components:{...re,VButton:te},provide(){return{formData:{}}},props:{modelValue:{type:[String,Number,Array,Object],default:void 0},item:{type:Object,default:()=>{}},modal:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{localValue:this.$props.modelValue}},methods:{onFiledChange(e){this.$emit("update:modelValue",e)},getComponentName(e){return Ie(e)},getComponentProps(e){return Fe(e,{disabled:this.disabled})}}});function pn(e,t,l,a,o,s){const n=B("VButton"),r=xe;return u(),c(r,null,{default:p(()=>[e.modal?(u(),c(n,{key:0,type:"modal",text:"查看"},{default:p(()=>[(u(),c(K(e.getComponentName(e.item.type)),L({modelValue:e.localValue,"onUpdate:modelValue":t[0]||(t[0]=i=>e.localValue=i)},e.getComponentProps(e.item),{"onUpdate:modelValue":e.onFiledChange}),null,16,["modelValue","onUpdate:modelValue"]))]),_:1})):(u(),c(K(e.getComponentName(e.item.type)),L({key:1,modelValue:e.localValue,"onUpdate:modelValue":t[1]||(t[1]=i=>e.localValue=i)},e.getComponentProps(e.item),{"onUpdate:modelValue":e.onFiledChange}),null,16,["modelValue","onUpdate:modelValue"]))]),_:1})}const cn=D(dn,[["render",pn]]),mn=A({name:"TableStyle",components:{VButton:Ne,CellEdit:cn,Warning:dt,...un},inject:["dev"],props:{headers:{type:Array,default:e=>[]},dataList:{type:Array,default:e=>[]},props:{type:Object,default:e=>{}},selection:{type:Boolean,default:!1},cellType:{type:Function,default:()=>{}},cellProps:{type:Function,default:()=>{}},cellEvent:{type:Function,default:()=>{}},rowButton:{type:Array,default:e=>[]},makeRowButton:{type:Function,default:()=>{}},loadChildren:{type:Function,default:()=>{}},dragSort:{type:Boolean,default:!1},localSortHandler:{type:Function,default:()=>{}},showRowButton:{type:Boolean,default:!0}},emits:["select-change","sort-change","cell-change","btn-action","mounted","drag-sort"],setup(e,{emit:t}){Oe(()=>{e.dragSort&&f()});const l=_(0),a=U(()=>{var b,h;if(e.rowButton.length===1)return;let w=0;for(let S=0;S<((b=e.rowButton)==null?void 0:b.length);S++){const k=e.rowButton[S];if(k.ignoreWith!==!0)if(k.type==="group")w+=98;else{const E=k.width||1;w+=(k.text?(h=k==null?void 0:k.props)!=null&&h.icon?90:78:65)*E}}return w}),o=b=>{t("select-change",b)},s=b=>{t("sort-change",b)},n=b=>({sortable:b.sortable?"custom":!1,...b.props}),r=(b,h,w)=>{t("cell-change",{index:b,field:h,value:w})},i=b=>{t("btn-action",b),m.value++},d=_(null),m=_(0),f=()=>{const b=document.querySelector(".el-table__body-wrapper tbody");Dl.create(b,{onEnd(h){t("drag-sort",h)}})},v=_([]);return{rowKey:l,actionWidth:a,handleSelectionChange:o,sortTable:s,getColumnProps:n,cellChange:r,btnAction:i,tabledom:d,rowAction:m,indexs:v,rowClassName:({row:b,rowIndex:h})=>`table-tr-${h}`}}}),hn={devtool:"{devId: `headers[${index}]`, dev: dev, parent: 2}"},fn=["innerHTML"];function bn(e,t,l,a,o,s){const n=gl,r=B("warning"),i=Q,d=se,m=B("cell-edit"),f=B("v-button"),v=vl,b=wl;return u(),c(b,L({id:"table",ref:"tabledome",data:e.dataList,load:e.loadChildren,style:{width:"100%"}},e.props,{"header-cell-style":{background:"#eef1f6",color:"#606266"},"row-class-name":e.rowClassName,onSelectionChange:e.handleSelectionChange,onSortChange:e.sortTable}),{empty:p(()=>[$(O(e.props.emptyText||"没有数据"),1)]),default:p(()=>[e.selection?(u(),c(n,{key:0,type:"selection"})):V("",!0),(u(!0),g(j,null,F(e.headers.filter(h=>h.type!=="hidden"),(h,w)=>(u(),c(n,L({key:w+"-table-column",prop:h.field},e.getColumnProps(h)),{header:p(()=>[x("span",hn,[$(O(h.label||h.field)+" ",1),h.info?(u(),c(d,{key:0,effect:"dark",placement:"top-start"},{content:p(()=>[x("span",{innerHTML:h.info},null,8,fn)]),default:p(()=>[y(i,null,{default:p(()=>[y(r)]),_:1})]),_:2},1024)):V("",!0)])]),default:p(S=>[h.edit?(u(),c(m,L({key:`${w}-${e.rowKey}`,modelValue:S.row[S.column.property],"onUpdate:modelValue":k=>S.row[S.column.property]=k},{item:h,disabled:h.props&&h.props.disabled},{"onUpdate:modelValue":k=>e.cellChange(S.index_,h.field,k)}),null,16,["modelValue","onUpdate:modelValue"])):(u(),c(K(e.cellType(h)),ce(L({key:1},e.cellProps(h,S))),null,16))]),_:2},1040,["prop"]))),128)),e.showRowButton&&e.rowButton.length>0?(u(),c(n,{key:1,label:"操作",fixed:"right",width:e.actionWidth},{default:p(h=>[(u(),c(f,{key:e.rowAction+"-"+h.$index,buttons:e.makeRowButton(e.rowButton,h.row,h.$index),"prefix-path":"rowButton",onAction:e.btnAction},null,8,["buttons","onAction"]))]),_:1},8,["width"])):V("",!0),y(v)]),_:1},16,["data","load","row-class-name","onSelectionChange","onSortChange"])}const yn=D(mn,[["render",bn]]),ye=ct,gn=A({name:"VIcon",props:{name:{type:String,required:!0}},setup(e){const t=()=>null;if(e.name===void 0)return t;if(e.name.indexOf("el-")===0){const l=Xe(e.name.replace("el-icon-",""),"-"),a=ye[l];if(!a)return t;const o={height:"1em",width:"1em"};return()=>y(a,{style:o},null)}if(ye[e.name]){const l=ye[e.name],a={height:"1em",width:"1em"};return()=>y(l,{style:a},null)}return e.name.indexOf("ra-")===0?()=>y("i",{class:"iconfont "+e.name},null):t}}),vn=A({name:"VTable",components:{VIcon:gn,VForm:Le,VButton:Ne,ExportAddButton:ms,TableStyle:yn},provide(){return{dev:this.dev}},inheritAttrs:!1,props:{dev:{type:Boolean,default:!1},headers:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},listApi:{type:String,default:""},infoApi:{type:String,default:""},schemaHandle:{type:Function,default:e=>e},filter:{type:Array,default:()=>[]},batchButton:{type:Array,default:()=>[]},normalButton:{type:Array,default:()=>[]},rowButton:{type:Array,default:()=>[]},showPagination:{type:Boolean,default:!0},showNormalButton:{type:Boolean,default:!0},showBatchButton:{type:Boolean,default:!0},showRowButton:{type:Boolean,default:!0},showFilter:{type:Boolean,default:!0},showSelection:{type:Boolean,default:void 0},selectedNotice:{type:[String,Object],default:""},listIncrease:{type:[Boolean,Object],default:!1},tableProps:{type:Object,default:e=>{}},exportAble:{type:Boolean,default:!1},exportCurrentPageAble:{type:Boolean,default:!1},tabs:{type:Array,default:e=>[]},rowHandler:{type:Function,default:(e,t)=>e},dragSort:{type:[Object,String,Boolean],default:()=>""},syncUrl:{type:Boolean,default:!0}},emits:["cell-change","unshiftList","deleteList","updateList","topList","dragSort","selection"],data(){var e;const t={border:!0,stripe:!0,size:"default",rowKey:"id",lazy:!0,defaultExpandAll:!1,expandRowKeys:[1]};let l="";this.$props.tabs.length>0&&(l=this.$props.tabs[0].value),this.$route&&this.$route.query.tab&&(l=this.$route.query.tab);const a=Object.assign({},this.$route?this.$route.query:{},this.queryParams());Object.keys(a).forEach(n=>{n.indexOf("[]")>-1&&(a[n.replace("[]","")]=a[n],delete a[n])});let o=!1;q(this.$props.dragSort)&&this.$props.dragSort&&(o=!0),J(this.$props.dragSort)&&this.$props.dragSort.sortApi&&(o=!0),pe(this.$props.dragSort)&&(o=this.$props.dragSort);const s={...this.$props.tableProps};return s.rowKey==="__random__"&&(s.rowKey=()=>new Date().getTime()+Math.random()),a._sort_by!==void 0&&(s.defaultSort={prop:a._sort_by,order:a._sort_type==="desc"?"descending":"ascending"}),{rowKey:0,formKey:0,tableKey:0,tableDefaultProps:t,filterFormOptions:{inline:!0,labelPosition:"right",labelWidth:0,submitButton:{innerHTML:"查询"},cancelButton:{innerHTML:"重置"}},tableNormalButton:this.$props.normalButton,tableBatchButton:this.$props.batchButton,tableRowButton:this.$props.rowButton,tableHeaders:this.$props.headers.filter(n=>n).filter(n=>n.hidden!==!0),tableFilter:this.$props.filter,tableList:this.$props.list,tableSelectedNotice:this.$props.selectedNotice,tableShowPagination:this.$props.showPagination,tableTableProps:Object.assign({},t,s),selectionRows:[],tableExportAble:this.$props.exportAble,tableExportCurrentPageAble:this.$props.exportCurrentPageAble,tableTabs:this.$props.tabs,tableListApi:this.$props.listApi,dragSortEnable:o,tablePage:Object.assign({ps:a._ps?parseInt(a._ps):20,sizes:[20,100,200],pn:a._pn?parseInt(a._pn):1,total:0},((e=this.$props.tableProps)==null?void 0:e.page)||{}),paginationKey:0,filterForm:this.$props.syncUrl?a:{},loading:!1,sort:null,activeTab:l+"",exporting:!1}},computed:{enableSelection(){return this.showSelection===!0?!0:this.tableBatchButton.length!==0},batchButtonCol(){if(this.tableBatchButton.length===0&&this.tableNormalButton.length===0)return 0;const e=this.tableBatchButton.length;let t=this.tableBatchButton.length+this.tableNormalButton.length;return this.$props.exportCurrentPageAble&&(t+=1),Math.round(e/t*24)},showFilterCard(){return this.tableFilter.length>0},actionWidth(){if(this.tableRowButton.length===1)return;let e=0;return this.tableRowButton.forEach(t=>{e+=t.text?73:60}),e},listIncreaseConf(){return pe(this.$props.listIncrease)?this.$props.listIncrease===!1?{state:!1}:{state:!0,type:"append",location:"beforeList"}:this.$props.listIncrease},selectedInfoPosition(){return J(this.tableSelectedNotice)?this.tableSelectedNotice.position:"beforePagination"},selectedInfo(){const e={selectedCount:this.selectionRows.length},t=J(this.tableSelectedNotice)?this.tableSelectedNotice.text:this.tableSelectedNotice,l=t.match(/{([\s\S]*?)}/g);if(!l)return t;const a=l.map(s=>s.replace("{","").replace("}","")),o=this.tableHeaders.map(s=>s.field);for(const s in a){const n=a[s].split("|");if(n.length===1||o.indexOf(n[0])===-1)continue;const r=this.selectionRows.map(i=>i[n[0]]);e[a[s]]=Gt.execute(r,n.slice(1))}return P(t,e)}},beforeCreate(){this.$props.infoApi&&this.$http.request({method:"GET",url:this.$props.infoApi}).then(({data:e})=>{e=this.$props.schemaHandle(e),Object.keys(e).forEach(l=>{l==="tableProps"?this["table"+Ue(l)]=Object.assign({},this.tableDefaultProps,e[l]):this["table"+Ue(l)]=e[l]});let t="";this.tableTabs.length>0&&(t=this.tableTabs[0].value),this.$route&&this.$route.query.tab&&(t=this.$route.query.tab),this.activeTab=t+"",console.log("beforeCreate"),this.load()})},mounted(){this.$nextTick(()=>{console.log("mounted.$nextTick"),!this.$props.infoApi&&this.load()})},methods:{changeTab(e,t){this.activeTab=this.tableTabs[e.index].value+"",console.log("changeTab",e.index),this.load()},resetFilter(){const e=this.queryParams();Object.keys(this.filterForm).forEach(t=>{delete e[t],delete e[t+"[]"]}),ze(e),this.filterForm={},this.formKey++,console.log("resetFilter",this.filterForm),this.load()},cellType(e){let t=e.type||"span";return t=t==="input"?"span":t,`cell-${t}`},cellProps(e,t){let l={data:t.row[t.column.property],column:e,scope:t};return this.cellType(e)==="cell-sort-index"&&(l.onSortIndexChange=({from:a,to:o})=>{var s;if(a!==o&&((s=this.tableList)==null?void 0:s.length)>0){o>this.tableList.length-1&&(o=this.tableList.length-1),o<=0&&(o=0);const n=this.tableList.splice(a,1)[0];this.tableList.splice(o,0,n),this.tableKey++,setTimeout(()=>{const r=document.getElementsByClassName(`table-tr-${o}`)[0];r.classList.forEach(i=>{}),(o+1)%2===0&&r.classList.toggle("el-table__row--striped"),r.classList.add("table-highlight"),ve("table-highlight"),setTimeout(()=>{r.classList.remove(["table-highlight"]),(o+1)%2===0&&r.classList.toggle("el-table__row--striped")},2e3)},60)}}),l.row=t.row,e.type==="tpl"&&(l.tpl=e.tpl||""),e.cellProps!==void 0&&(l=Object.assign(l,e.cellProps)),l},getAvailableFilter(){var e;const t={};return Object.keys(this.filterForm).length===0&&((e=this.tableFilter)==null||e.forEach(l=>{l.value!==void 0&&(t[l.field]=_t(l))})),Object.keys(this.filterForm).map(l=>{this.filterForm[l]!==""&&this.filterForm[l]!==void 0&&(t[l]=this.filterForm[l])}),t},searchAction(){const e=this.getAvailableFilter();if(Object.keys(e).length===0){this.$message({message:"请填写筛选条件",type:"warning"});return}console.log("searchAction"),this.load()},load(e={},t={}){var l;if(!this.tableListApi)return;this.loading=!0,e.resetPage!==void 0&&e.resetPage!==!1&&(this.tablePage.pn=1);const a=this.getAvailableFilter(),o=this.showPagination?{_pn:this.tablePage.pn,_ps:this.tablePage.ps}:{},s=Object.assign({},a,o,this.sort,t,this.$route?this.$route.params:{}),n=(l=C.cloneDeep(this.tableTabs))==null?void 0:l.map(r=>(r.value=r.value+"",r));if(this.activeTab){const r=C.findIndex(n,{value:this.activeTab});console.log("activeTab",this.activeTab,n,r),r>-1&&(s[this.tableTabs[r].field]=this.activeTab)}this.syncParamsToUrl(s),this.$http.request({type:"GET",url:this.tableListApi,params:s}).then(({data:r})=>(this.tableList=(r.list||[]).map(this.rowHandler),this.tablePage=Object.assign(this.tablePage,r.page||{}),this.loading=!1,this.tableKey++,s))},syncParamsToUrl(e){if(!this.syncUrl)return;const t=C.merge({},C.cloneDeep(this.queryParams()),C.cloneDeep(e)),l={_pn:1,_ps:20};Object.keys(l).forEach(a=>{t[a]===l[a]&&delete t[a]}),ze(t)},handleSelectionChange(e){this.selectionRows=e,this.$emit("selection",e)},batchButtonPreCheck(){return this.selectionRows.length===0?(this.$message({message:"请勾选相应记录",type:"warning"}),!1):!0},batchMetaData(e){const t=[];return this.selectionRows.forEach(l=>{l.id!==void 0&&t.push(l.id)}),{ids:t,_selection:this.selectionRows,_query:this.queryParams()}},batchDynamicExtra(e){const t=[],l={};if(e&&e.batchApiParamsKey&&e.batchApiParamsKey.forEach(s=>{l[s]=[]}),this.selectionRows.forEach(s=>{s.id!==void 0&&t.push(s.id),Object.keys(l).forEach(n=>{s[n]!==void 0&&l[n].push(s[n])})}),t.length===0)return this.$message({message:"列表记录缺少主键 id",type:"warning"}),{};const a=t.join(","),o={id:a,ids:a};return Object.keys(l).forEach(s=>{o[s]=l[s].join(",")}),e=e||{},e.data=e.data||{},e.data._selected=this.selectionRows,e.url!==void 0&&(e.params=e.params||{},Object.keys(l).forEach(s=>{e.params[s]=l[s].join(",")}),e.url.indexOf("{id}")===-1&&(e.params.id=a),Jt(e.url)&&(e.url=P(e.url,o))),e},batchBtnAction(){console.log("batchBtnAction"),this.load()},pssChange(e){this.tablePage.pn=1,this.tablePage.ps=e,this.paginationKey+=1,console.log("pssChange"),this.load()},pnChange(e){if(e-this.tablePage.pn>100){this.$message({message:"禁止大跨度翻页",type:"error"}),this.paginationKey+=1;return}this.tablePage.pn=e,this.load({resetPage:!1})},isArray(e){return T(e)},makeBatchButton(e){return e.map(t=>{var l,a;if(T(t))t=this.makeBatchButton(t);else if(t["pre-check"]=this.batchButtonPreCheck,t["dynamic-extra"]=this.batchDynamicExtra,t["meta-data"]=this.batchMetaData,(l=t==null?void 0:t.extra)!=null&&l.actionHandler)switch((a=t==null?void 0:t.extra)==null?void 0:a.actionHandler){case"@topList":t.extra.actionHandler=()=>{this.moveSelectedToTop()};break;case"@deleteList":t.extra.actionHandler=()=>{this.deleteSelected()};break}return t})},queryParams(){return et(location.hash)},queryString(){const e=location.hash.indexOf("?");return e===-1?"":location.hash.substring(e+1)},makeNormalButton(e){const t=this.queryParams();return e.filter(l=>{if(l.when){let a=l.when;return T(l.when[0])||(a=[l.when]),ee(t,a)}return!0}).map(l=>{var a,o,s;if(T(l))l=this.makeNormalButton(l);else if(l["meta-data"]=()=>({...this.queryParams(),_query:this.queryString(),tableList:this.tableList}),((a=l==null?void 0:l.extra)==null?void 0:a.initQueryParams)===!1&&(l["meta-data"]={}),(o=l==null?void 0:l.extra)!=null&&o.actionHandler)switch((s=l==null?void 0:l.extra)==null?void 0:s.actionHandler){case"@unshiftList":l.extra.actionHandler=n=>{var r,i;const d=N((r=l.extra)==null?void 0:r.parseFormData)?l.extra.parseFormData(n):n;d&&((i=this.tableList)==null||i.unshift(d),this.$emit("unshiftList",n))};break}return l})},fullPath(){return{route_full_path:encodeURIComponent(location.hash.replace("#",""))}},makeRowButton(e,t,l){const a=[];return C.cloneDeep(e.filter(o=>!!o)).forEach(o=>{o.type==="group"?a.push(o.subButton):a.push(o)}),a.filter(o=>{if(o.when){let s=o.when;return T(o.when[0])||(s=[o.when]),ee(t,s)}return!0}).map(o=>{var s,n,r;if(T(o))o=this.makeRowButton(o,t);else{const i=o.metaData||{};if(o["inject-data"]=()=>C.merge(this.queryParams(),i),o["meta-data"]=()=>{const d=this.fullPath();return{...this.queryParams(),...t,...d,...i}},((s=o==null?void 0:o.extra)==null?void 0:s.initQueryParams)===!1&&(o["meta-data"]={...t,...i}),(n=o==null?void 0:o.extra)!=null&&n.actionHandler)switch((r=o==null?void 0:o.extra)==null?void 0:r.actionHandler){case"@updateList":o.extra.actionHandler=d=>{this.tableList[l]=C.merge(this.tableList[l],d),this.$emit("updateList",d,l)};break;case"@deleteList":o.extra.actionHandler=()=>{this.tableList.splice(l,1),this.$emit("deleteList",l)};break;case"@unshiftList":o.extra.actionHandler=d=>{var m;(m=this.tableList)==null||m.unshift(d),this.$emit("unshiftList",d,l)};break;case"@topList":o.extra.actionHandler=d=>{console.log(l),this.moveItemToTop(l),this.$emit("topList",d,l)};break}}return o})},moveItemToTop(e){var t;const l=(t=this.tableList)==null?void 0:t.splice(e,1);this.tableList.unshift(l[0])},moveSelectedToTop(){for(let e=0;e<this.selectionRows.length;e++){const t=this.selectionRows[e],l=this.tableList.findIndex(a=>a.id===t.id);l>-1&&this.moveItemToTop(l)}},deleteSelected(){var e;for(let t=0;t<this.selectionRows.length;t++){const l=this.selectionRows[t],a=this.tableList.findIndex(o=>o.id===l.id);a>-1&&((e=this.tableList)==null||e.splice(a,1))}},listIncreaseRecord(){const e={};Object.keys(this.tableHeaders).forEach(t=>{e[t.field]=void 0}),this.listIncreaseConf.type==="append"?this.tableList.push(e):this.listIncreaseConf.type==="unshift"?this.tableList.unshift(e):console.warn("unknown listIncrease type"),this.rowKey++},cellChange(e,t,l){this.$emit("cell-change",{index:e,field:t,value:l})},getColumnProps(e){return{sortable:e.sortable?"custom":!1}},sortTable({column:e,order:t,prop:l}){if(!(t&&l)){this.sort=null;return}this.sort={_sort_by:l,_sort_type:t==="descending"?"desc":"asc"};const a={prop:l,order:t},o=this.tableTableProps.defaultSort;JSON.stringify(o)!==JSON.stringify(a)&&(this.tableTableProps.defaultSort=a,this.load())},loadChildren(e,t,l){this.$http.request({type:"GET",url:this.tableListApi.replace("/list","/children"),params:{pid:e.id}}).then(({data:a})=>{l(a||[])})},btnAction(){console.log("btnAction"),this.load()},getExportInfo(){return{listApi:this.tableListApi,params:this.filterForm,header:C.cloneDeep(this.tableHeaders),name:ns(this.$route?this.$route.matched:[],!1)}},exportCurrentTable(){this.exporting=!0;const e=[],t=[],l={};this.tableHeaders.forEach(s=>{e.push(s.label),l[s.field]=s,t.push(s.field)});const a=[];(this.tableList||[]).forEach(s=>{const n=[];t.forEach(r=>{let i=s[r];if(i===void 0){n.push("");return}const d=l[r];switch(d.type){case"enum":{const m=C.findIndex(d.options,{value:i}),f=d.options?d.options[m]:!1;i=f?f.label:i;break}}n.push(i)}),a.push(n)});const o=document.title||new Date().getTime();Pt(e,a,o,!1),this.exporting=!1},dragSortHandle(e){var t,l;if(!this.dragSortEnable)return;this.tableTableProps.defaultSort={};const{newIndex:a,oldIndex:o}=e;console.log("event",e);let s={};((t=this.tableList)==null?void 0:t.length)>0&&(s=this.tableList.splice(o,1)[0],this.tableList.splice(a,0,s),this.tableKey++);let n="",r=!1,i="此操作将会改变数据顺序, {oldIndex} => {newIndex}, 是否确认此操作?";if(q(this.$props.dragSort)&&this.$props.dragSort&&(n=this.$props.dragSort),J(this.$props.dragSort)&&this.$props.dragSort.sortApi&&(n=this.$props.dragSort.sortApi,r=this.$props.dragSort.confirm===!0,this.$props.dragSort.confirmMsg&&(i=this.$props.dragSort.confirmMsg),console.log("need",this.$props.dragSort,r)),!n)return;const d=[];if((l=this.tableList)==null||l.forEach(f=>{f.id!==void 0&&d.push(f.id)}),d.length===0)return;const m=()=>this.$http.request({method:"POST",url:n,data:{ids:d.join(",")}}).then(f=>{this.$message({type:"success",message:"排序更新成功, 数据将刷新"}),this.$emit("dragSort"),this.load()});r?it.confirm(P(i,{...s,oldIndex:o+1,newIndex:a+1}),"Warning",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{m()}).catch(()=>{const f=this.tableList.splice(a,1)[0];this.tableList.splice(o,0,f),this.tableKey++,Se({type:"info",message:"已取消"})}):m()},getListData(){return this.tableList},localSortHandler(e,t){console.log(e,t)}}}),wn={key:0,class:"selected-info"},Vn=["innerHTML"],kn={key:0,class:"selected-info"},Cn=["innerHTML"],Sn={key:0,class:"table-pagination"};function xn(e,t,l,a,o,s){const n=B("v-form"),r=at,i=B("v-button"),d=Y,m=B("export-add-button"),f=z,v=W,b=B("v-icon"),h=B("table-style"),w=rt,S=ut,k=bl,E=nt;return u(),g(j,null,[e.showFilter&&e.showFilterCard?(u(),c(r,{key:0,shadow:"never",class:"table-filter"},{default:p(()=>[X(e.$slots,"filter",{},()=>[e.tableFilter.length>0?(u(),c(n,{key:e.formKey,ref:"filter",modelValue:e.filterForm,"onUpdate:modelValue":t[0]||(t[0]=M=>e.filterForm=M),dev:e.dev,class:"filter-form","prefix-path":"filter",options:e.filterFormOptions,"form-items":e.tableFilter,"init-query-params":e.syncUrl,onSubmit:e.searchAction,onReset:e.resetFilter},null,8,["modelValue","dev","options","form-items","init-query-params","onSubmit","onReset"])):V("",!0)],!0)]),_:3})):V("",!0),X(e.$slots,"action",{},()=>[y(v,{gutter:20,style:{"margin-bottom":"20px"}},{default:p(()=>[e.showBatchButton?(u(),c(d,{key:0,span:e.batchButtonCol},{default:p(()=>[y(i,{buttons:e.makeBatchButton(e.tableBatchButton),"prefix-path":"batchButton",onAction:e.batchBtnAction},null,8,["buttons","onAction"]),e.tableBatchButton.length>0&&e.selectedInfoPosition==="afterBatchButton"?(u(),g("div",wn,[x("span",{innerHTML:e.selectedInfo},null,8,Vn)])):V("",!0)]),_:1},8,["span"])):V("",!0),e.showNormalButton?(u(),c(d,{key:1,span:24-e.batchButtonCol,class:"normal-button"},{default:p(()=>[y(i,{buttons:e.makeNormalButton(e.tableNormalButton),"prefix-path":"normalButton",onAction:e.load},null,8,["buttons","onAction"]),e.tableExportAble?(u(),c(m,{key:0,"get-info":e.getExportInfo},null,8,["get-info"])):V("",!0),e.tableExportCurrentPageAble?(u(),c(f,{key:1,type:"primary",loading:e.exporting,onClick:e.exportCurrentTable},{default:p(()=>[$("导出")]),_:1},8,["loading","onClick"])):V("",!0)]),_:1},8,["span"])):V("",!0)]),_:1})],!0),X(e.$slots,"before_table",{},void 0,!0),e.tableTabs.length>0?(u(),c(S,{key:1,modelValue:e.activeTab,"onUpdate:modelValue":t[1]||(t[1]=M=>e.activeTab=M),type:"card",onTabClick:e.changeTab},{default:p(()=>[(u(!0),g(j,null,F(e.tableTabs,(M,R)=>(u(),c(w,{key:R+"-pane",name:M.value+"",lazy:!0},{label:p(()=>[x("span",null,[y(b,{name:M.icon||""},null,8,["name"]),$(O(M.label),1)])]),default:p(()=>[X(e.$slots,"table",{},()=>[G((u(),c(h,{ref_for:!0,ref:"table",key:e.tableKey,headers:e.tableHeaders,"data-list":e.tableList,"drag-sort":e.dragSortEnable,props:e.tableTableProps,selection:e.enableSelection,"cell-type":e.cellType,"cell-props":e.cellProps,"row-button":e.tableRowButton,"show-row-button":e.showRowButton,"make-row-button":e.makeRowButton,"load-children":e.loadChildren,"local-sort-handler":e.localSortHandler,onSelectChange:e.handleSelectionChange,onSortChange:e.sortTable,onCellChange:e.cellChange,onBtnAction:e.btnAction,onMounted:e.load,onDragSort:e.dragSortHandle},null,8,["headers","data-list","drag-sort","props","selection","cell-type","cell-props","row-button","show-row-button","make-row-button","load-children","local-sort-handler","onSelectChange","onSortChange","onCellChange","onBtnAction","onMounted","onDragSort"])),[[E,e.loading]])],!0)]),_:2},1032,["name"]))),128))]),_:3},8,["modelValue","onTabClick"])):X(e.$slots,"table",{key:2},()=>[G((u(),c(h,{ref:"table",key:e.tableKey,headers:e.tableHeaders,"data-list":e.tableList,"drag-sort":e.dragSortEnable,props:e.tableTableProps,selection:e.enableSelection,"cell-type":e.cellType,"cell-props":e.cellProps,"row-button":e.tableRowButton,"show-row-button":e.showRowButton,"make-row-button":e.makeRowButton,"load-children":e.loadChildren,"local-sort-handler":e.localSortHandler,onSelectChange:e.handleSelectionChange,onSortChange:e.sortTable,onCellChange:e.cellChange,onBtnAction:e.btnAction,onDragSort:e.dragSortHandle},null,8,["headers","data-list","drag-sort","props","selection","cell-type","cell-props","row-button","show-row-button","make-row-button","load-children","local-sort-handler","onSelectChange","onSortChange","onCellChange","onBtnAction","onDragSort"])),[[E,e.loading]])],!0),e.listIncreaseConf.state&&e.listIncreaseConf.location==="afterList"?(u(),c(f,{key:3,class:"list-incr-button",onClick:e.listIncreaseRecord},{default:p(()=>[$("添加")]),_:1},8,["onClick"])):V("",!0),y(v,{style:{display:"flex"}},{default:p(()=>[y(d,{span:12,style:{"min-height":"15px"}},{default:p(()=>[e.tableBatchButton.length>0&&e.selectedInfoPosition==="beforePagination"?(u(),g("div",kn,[x("span",{innerHTML:e.selectedInfo},null,8,Cn)])):V("",!0)]),_:1}),y(d,{span:12},{default:p(()=>[X(e.$slots,"page",{},()=>[e.tableShowPagination?(u(),g("div",Sn,[(u(),c(k,{key:e.paginationKey,background:"",layout:"total, sizes, prev, pager, next","page-size":e.tablePage.ps,"page-sizes":e.tablePage.sizes,"current-page":e.tablePage.pn,total:e.tablePage.total,onSizeChange:e.pssChange,onCurrentChange:t[2]||(t[2]=M=>e.pnChange(M))},null,8,["page-size","page-sizes","current-page","total","onSizeChange"]))])):V("",!0)],!0)]),_:3})]),_:3})],64)}const Lt=D(vn,[["render",xn],["__scopeId","data-v-fb4db123"]]),Mt=Object.freeze(Object.defineProperty({__proto__:null,default:Lt},Symbol.toStringTag,{value:"Module"})),_n=Object.freeze(Object.defineProperty({__proto__:null,VTable:Lt},Symbol.toStringTag,{value:"Module"})),$n=Object.freeze(Object.defineProperty({__proto__:null,RegComponents:Jo,VBtn:Ne,VButton:te,VButtonGroup:Tt},Symbol.toStringTag,{value:"Module"}));({...Uo,..._n,...$n});export{gn as B,Bo as U,Ne as Y,It as a,Lt as b,Le as q,Gs as r};
