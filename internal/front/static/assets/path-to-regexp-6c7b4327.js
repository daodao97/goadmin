function N(e){for(var i=[],r=0;r<e.length;){var c=e[r];if(c==="*"||c==="+"||c==="?"){i.push({type:"MODIFIER",index:r,value:e[r++]});continue}if(c==="\\"){i.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});continue}if(c==="{"){i.push({type:"OPEN",index:r,value:e[r++]});continue}if(c==="}"){i.push({type:"CLOSE",index:r,value:e[r++]});continue}if(c===":"){for(var d="",n=r+1;n<e.length;){var u=e.charCodeAt(n);if(u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||u===95){d+=e[n++];continue}break}if(!d)throw new TypeError("Missing parameter name at ".concat(r));i.push({type:"NAME",index:r,value:d}),r=n;continue}if(c==="("){var p=1,t="",n=r+1;if(e[n]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(n));for(;n<e.length;){if(e[n]==="\\"){t+=e[n++]+e[n++];continue}if(e[n]===")"){if(p--,p===0){n++;break}}else if(e[n]==="("&&(p++,e[n+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(n));t+=e[n++]}if(p)throw new TypeError("Unbalanced pattern at ".concat(r));if(!t)throw new TypeError("Missing pattern at ".concat(r));i.push({type:"PATTERN",index:r,value:t}),r=n;continue}i.push({type:"CHAR",index:r,value:e[r++]})}return i.push({type:"END",index:r,value:""}),i}function P(e,i){i===void 0&&(i={});for(var r=N(e),c=i.prefixes,d=c===void 0?"./":c,n="[^".concat(M(i.delimiter||"/#?"),"]+?"),u=[],p=0,t=0,v="",f=function(h){if(t<r.length&&r[t].type===h)return r[t++].value},a=function(h){var w=f(h);if(w!==void 0)return w;var s=r[t],R=s.type,b=s.index;throw new TypeError("Unexpected ".concat(R," at ").concat(b,", expected ").concat(h))},E=function(){for(var h="",w;w=f("CHAR")||f("ESCAPED_CHAR");)h+=w;return h};t<r.length;){var y=f("CHAR"),x=f("NAME"),l=f("PATTERN");if(x||l){var o=y||"";d.indexOf(o)===-1&&(v+=o,o=""),v&&(u.push(v),v=""),u.push({name:x||p++,prefix:o,suffix:"",pattern:l||n,modifier:f("MODIFIER")||""});continue}var g=y||f("ESCAPED_CHAR");if(g){v+=g;continue}v&&(u.push(v),v="");var A=f("OPEN");if(A){var o=E(),T=f("NAME")||"",m=f("PATTERN")||"",C=E();a("CLOSE"),u.push({name:T||(m?p++:""),pattern:T&&!m?n:m,prefix:o,suffix:C,modifier:f("MODIFIER")||""});continue}a("END")}return u}function S(e,i){return D(P(e,i),i)}function D(e,i){i===void 0&&(i={});var r=O(i),c=i.encode,d=c===void 0?function(t){return t}:c,n=i.validate,u=n===void 0?!0:n,p=e.map(function(t){if(typeof t=="object")return new RegExp("^(?:".concat(t.pattern,")$"),r)});return function(t){for(var v="",f=0;f<e.length;f++){var a=e[f];if(typeof a=="string"){v+=a;continue}var E=t?t[a.name]:void 0,y=a.modifier==="?"||a.modifier==="*",x=a.modifier==="*"||a.modifier==="+";if(Array.isArray(E)){if(!x)throw new TypeError('Expected "'.concat(a.name,'" to not repeat, but got an array'));if(E.length===0){if(y)continue;throw new TypeError('Expected "'.concat(a.name,'" to not be empty'))}for(var l=0;l<E.length;l++){var o=d(E[l],a);if(u&&!p[f].test(o))throw new TypeError('Expected all "'.concat(a.name,'" to match "').concat(a.pattern,'", but got "').concat(o,'"'));v+=a.prefix+o+a.suffix}continue}if(typeof E=="string"||typeof E=="number"){var o=d(String(E),a);if(u&&!p[f].test(o))throw new TypeError('Expected "'.concat(a.name,'" to match "').concat(a.pattern,'", but got "').concat(o,'"'));v+=a.prefix+o+a.suffix;continue}if(!y){var g=x?"an array":"a string";throw new TypeError('Expected "'.concat(a.name,'" to be ').concat(g))}}return v}}function M(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function O(e){return e&&e.sensitive?"":"i"}export{S as c};
